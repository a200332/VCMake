<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../displayToc.js"></script>
<script language="JavaScript" src="../../tocParas.js"></script>
<script language="JavaScript" src="../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../scineplex.css">
<title></title>
<link rel="stylesheet" href="../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#EXAMPLES">EXAMPLES</a>
    <ul>
      <li><a href="#Standard-preamble">&#x211E; 0: Standard preamble</a></li>
      <li><a href="#Generic-Unicode-savvy-filter">&#x211E; 1: Generic Unicode-savvy filter</a></li>
      <li><a href="#Fine-tuning-Unicode-warnings">&#x211E; 2: Fine-tuning Unicode warnings</a></li>
      <li><a href="#Declare-source-in-utf8-for-identifiers-and-literals">&#x211E; 3: Declare source in utf8 for identifiers and literals</a></li>
      <li><a href="#Characters-and-their-numbers">&#x211E; 4: Characters and their numbers</a></li>
      <li><a href="#Unicode-literals-by-character-number">&#x211E; 5: Unicode literals by character number</a></li>
      <li><a href="#Get-character-name-by-number">&#x211E; 6: Get character name by number</a></li>
      <li><a href="#Get-character-number-by-name">&#x211E; 7: Get character number by name</a></li>
      <li><a href="#Unicode-named-characters">&#x211E; 8: Unicode named characters</a></li>
      <li><a href="#Unicode-named-sequences">&#x211E; 9: Unicode named sequences</a></li>
      <li><a href="#Custom-named-characters">&#x211E; 10: Custom named characters</a></li>
      <li><a href="#Names-of-CJK-codepoints">&#x211E; 11: Names of CJK codepoints</a></li>
      <li><a href="#Explicit-encode-decode">&#x211E; 12: Explicit encode/decode</a></li>
      <li><a href="#Decode-program-arguments-as-utf8">&#x211E; 13: Decode program arguments as utf8</a></li>
      <li><a href="#Decode-program-arguments-as-locale-encoding">&#x211E; 14: Decode program arguments as locale encoding</a></li>
      <li><a href="#Declare-STD-IN-OUT-ERR-to-be-utf8">&#x211E; 15: Declare STD{IN,OUT,ERR} to be utf8</a></li>
      <li><a href="#Declare-STD-IN-OUT-ERR-to-be-in-locale-encoding">&#x211E; 16: Declare STD{IN,OUT,ERR} to be in locale encoding</a></li>
      <li><a href="#Make-file-I-O-default-to-utf8">&#x211E; 17: Make file I/O default to utf8</a></li>
      <li><a href="#Make-all-I-O-and-args-default-to-utf8">&#x211E; 18: Make all I/O and args default to utf8</a></li>
      <li><a href="#Open-file-with-specific-encoding">&#x211E; 19: Open file with specific encoding</a></li>
      <li><a href="#Unicode-casing">&#x211E; 20: Unicode casing</a></li>
      <li><a href="#Unicode-case-insensitive-comparisons">&#x211E; 21: Unicode case-insensitive comparisons</a></li>
      <li><a href="#Match-Unicode-linebreak-sequence-in-regex">&#x211E; 22: Match Unicode linebreak sequence in regex</a></li>
      <li><a href="#Get-character-category">&#x211E; 23: Get character category</a></li>
      <li><a href="#Disabling-Unicode-awareness-in-builtin-charclasses">&#x211E; 24: Disabling Unicode-awareness in builtin charclasses</a></li>
      <li><a href="#Match-Unicode-properties-in-regex-with-p-P">&#x211E; 25: Match Unicode properties in regex with \p, \P</a></li>
      <li><a href="#Custom-character-properties">&#x211E; 26: Custom character properties</a></li>
      <li><a href="#Unicode-normalization">&#x211E; 27: Unicode normalization</a></li>
      <li><a href="#Convert-non-ASCII-Unicode-numerics">&#x211E; 28: Convert non-ASCII Unicode numerics</a></li>
      <li><a href="#Match-Unicode-grapheme-cluster-in-regex">&#x211E; 29: Match Unicode grapheme cluster in regex</a></li>
      <li><a href="#Extract-by-grapheme-instead-of-by-codepoint-regex">&#x211E; 30: Extract by grapheme instead of by codepoint (regex)</a></li>
      <li><a href="#Extract-by-grapheme-instead-of-by-codepoint-substr">&#x211E; 31: Extract by grapheme instead of by codepoint (substr)</a></li>
      <li><a href="#Reverse-string-by-grapheme">&#x211E; 32: Reverse string by grapheme</a></li>
      <li><a href="#String-length-in-graphemes">&#x211E; 33: String length in graphemes</a></li>
      <li><a href="#Unicode-column-width-for-printing">&#x211E; 34: Unicode column-width for printing</a></li>
      <li><a href="#Unicode-collation">&#x211E; 35: Unicode collation</a></li>
      <li><a href="#Case--and-accent-insensitive-Unicode-sort">&#x211E; 36: Case- and accent-insensitive Unicode sort</a></li>
      <li><a href="#Unicode-locale-collation">&#x211E; 37: Unicode locale collation</a></li>
      <li><a href="#Making-cmp-work-on-text-instead-of-codepoints">&#x211E; 38: Making cmp work on text instead of codepoints</a></li>
      <li><a href="#Case--and-accent-insensitive-comparisons">&#x211E; 39: Case- and accent-insensitive comparisons</a></li>
      <li><a href="#Case--and-accent-insensitive-locale-comparisons">&#x211E; 40: Case- and accent-insensitive locale comparisons</a></li>
      <li><a href="#Unicode-linebreaking">&#x211E; 41: Unicode linebreaking</a></li>
      <li><a href="#Unicode-text-in-DBM-hashes-the-tedious-way">&#x211E; 42: Unicode text in DBM hashes, the tedious way</a></li>
      <li><a href="#Unicode-text-in-DBM-hashes-the-easy-way">&#x211E; 43: Unicode text in DBM hashes, the easy way</a></li>
      <li><a href="#PROGRAM:-Demo-of-Unicode-collation-and-printing">&#x211E; 44: PROGRAM: Demo of Unicode collation and printing</a></li>
    </ul>
  </li>
  <li><a href="#SEE-ALSO">SEE ALSO</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#COPYRIGHT-AND-LICENCE">COPYRIGHT AND LICENCE</a></li>
  <li><a href="#REVISION-HISTORY">REVISION HISTORY</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>perlunicook - cookbookish examples of handling Unicode in Perl</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This manpage contains short recipes demonstrating how to handle common Unicode operations in Perl, plus one complete program at the end. Any undeclared variables in individual recipes are assumed to have a previous appropriate value in them.</p>

<h1 id="EXAMPLES">EXAMPLES</h1>

<h2 id="Standard-preamble">&#x211E; 0: Standard preamble</h2>

<p>Unless otherwise notes, all examples below require this standard preamble to work correctly, with the <code><span class="comment">#!</span>
</code> adjusted to work on your system:</p>

<pre><code> <span class="comment">#!/usr/bin/env perl</span>
 
 <span class="keyword">use</span> <span class="variable">utf8</span><span class="operator">;</span>      <span class="comment"># so literals and identifiers can be in UTF-8</span>
 <span class="keyword">use</span> <span class="variable">v5</span><span class="number">.12</span><span class="operator">;</span>     <span class="comment"># or later to get "unicode_strings" feature</span>
 <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>    <span class="comment"># quote strings, declare variables</span>
 <span class="keyword">use</span> <span class="variable">warnings</span><span class="operator">;</span>  <span class="comment"># on by default</span>
 <span class="keyword">use</span> <span class="variable">warnings</span>  <span class="string">qw(FATAL utf8)</span><span class="operator">;</span>    <span class="comment"># fatalize encoding glitches</span>
 <span class="keyword">use</span> <span class="keyword">open</span>      <span class="string">qw(:std :encoding(UTF-8))</span><span class="operator">;</span> <span class="comment"># undeclared streams in UTF-8</span>
 <span class="keyword">use</span> <span class="variable">charnames</span> <span class="string">qw(:full :short)</span><span class="operator">;</span>  <span class="comment"># unneeded in v5.16</span>
</code></pre>

<p>This <i>does</i> make even Unix programmers <code>binmode</code> your binary streams, or open them with <code>:raw</code>, but that&#39;s the only way to get at them portably anyway.</p>

<p><b>WARNING</b>: <code>use autodie</code> (pre 2.26) and <code>use open</code> do not get along with each other.</p>

<h2 id="Generic-Unicode-savvy-filter">&#x211E; 1: Generic Unicode-savvy filter</h2>

<p>Always decompose on the way in, then recompose on the way out.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">Unicode::Normalize</span><span class="operator">;</span>
 
 <span class="keyword">while</span> <span class="operator">(&lt;&gt;)</span> <span class="operator">{</span>
     <span class="variable">$_</span> <span class="operator">=</span> <span class="variable">NFD</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">);</span>   <span class="comment"># decompose + reorder canonically</span>
     <span class="operator">...</span>
 <span class="operator">}</span> <span class="keyword">continue</span> <span class="operator">{</span>
     <span class="keyword">print</span> <span class="variable">NFC</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">);</span>  <span class="comment"># recompose (where possible) + reorder canonically</span>
 <span class="operator">}</span>
</code></pre>

<h2 id="Fine-tuning-Unicode-warnings">&#x211E; 2: Fine-tuning Unicode warnings</h2>

<p>As of v5.14, Perl distinguishes three subclasses of UTF&#x2011;8 warnings.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">v5</span><span class="number">.14</span><span class="operator">;</span>                  <span class="comment"># subwarnings unavailable any earlier</span>
 <span class="keyword">no</span> <span class="variable">warnings</span> <span class="string">"nonchar"</span><span class="operator">;</span>      <span class="comment"># the 66 forbidden non-characters</span>
 <span class="keyword">no</span> <span class="variable">warnings</span> <span class="string">"surrogate"</span><span class="operator">;</span>    <span class="comment"># UTF-16/CESU-8 nonsense</span>
 <span class="keyword">no</span> <span class="variable">warnings</span> <span class="string">"non_unicode"</span><span class="operator">;</span>  <span class="comment"># for codepoints over 0x10_FFFF</span>
</code></pre>

<h2 id="Declare-source-in-utf8-for-identifiers-and-literals">&#x211E; 3: Declare source in utf8 for identifiers and literals</h2>

<p>Without the all-critical <code>use utf8</code> declaration, putting UTF&#x2011;8 in your literals and identifiers won&rsquo;t work right. If you used the standard preamble just given above, this already happened. If you did, you can do things like this:</p>

<pre><code> <span class="keyword">use</span> <span class="variable">utf8</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$measure</span>   <span class="operator">=</span> <span class="string">"ÃngstrÃ¶m"</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">@Î¼soft</span>     <span class="operator">=</span> <span class="string">qw( cp852 cp1251 cp1252 )</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">@á½ÏÎ­ÏÎ¼ÎµÎ³Î±Ï</span> <span class="operator">=</span> <span class="string">qw( á½ÏÎ­Ï  Î¼ÎµÎ³Î±Ï )</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">@é¯</span>        <span class="operator">=</span> <span class="string">qw( koi8-f koi8-u koi8-r )</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$motto</span>     <span class="operator">=</span> <span class="string">"ðª ð ðª"</span><span class="operator">;</span> <span class="comment"># FAMILY, GROWING HEART, DROMEDARY CAMEL</span>
</code></pre>

<p>If you forget <code>use utf8</code>, high bytes will be misunderstood as separate characters, and nothing will work right.</p>

<h2 id="Characters-and-their-numbers">&#x211E; 4: Characters and their numbers</h2>

<p>The <code>ord</code> and <code>chr</code> functions work transparently on all codepoints, not just on ASCII alone &mdash; nor in fact, not even just on Unicode alone.</p>

<pre><code> <span class="comment"># ASCII characters</span>
 <span class="keyword">ord</span><span class="operator">(</span><span class="string">"A"</span><span class="operator">)</span>
 <span class="keyword">chr</span><span class="operator">(</span><span class="number">65</span><span class="operator">)</span>
 
 <span class="comment"># characters from the Basic Multilingual Plane</span>
 <span class="keyword">ord</span><span class="operator">(</span><span class="string">"Î£"</span><span class="operator">)</span>
 <span class="keyword">chr</span><span class="operator">(</span><span class="number">0x3A3</span><span class="operator">)</span>
 
 <span class="comment"># beyond the BMP</span>
 <span class="keyword">ord</span><span class="operator">(</span><span class="string">"ð"</span><span class="operator">)</span>               <span class="comment"># MATHEMATICAL ITALIC SMALL N</span>
 <span class="keyword">chr</span><span class="operator">(</span><span class="number">0x1D45B</span><span class="operator">)</span>
 
 <span class="comment"># beyond Unicode! (up to MAXINT)</span>
 <span class="keyword">ord</span><span class="operator">(</span><span class="string">"\x{20_0000}"</span><span class="operator">)</span>
 <span class="keyword">chr</span><span class="operator">(</span><span class="number">0x20_0000</span><span class="operator">)</span>
</code></pre>

<h2 id="Unicode-literals-by-character-number">&#x211E; 5: Unicode literals by character number</h2>

<p>In an interpolated literal, whether a double-quoted string or a regex, you may specify a character by its number using the <code><span class="operator">\x</span><span class="operator">{</span>
<i>HHHHHH</i>}</code> escape.</p>

<pre><code> <span class="variable">String</span><span class="operator">:</span> <span class="string">"\x{3a3}"</span>
 <span class="variable">Regex</span><span class="operator">:</span>  <span class="regex">/\x{3a3}/</span>
 
 <span class="variable">String</span><span class="operator">:</span> <span class="string">"\x{1d45b}"</span>
 <span class="variable">Regex</span><span class="operator">:</span>  <span class="regex">/\x{1d45b}/</span>
 
 <span class="comment"># even non-BMP ranges in regex work fine</span>
 <span class="operator">/</span><span class="operator">[</span><span class="operator">\x</span><span class="operator">{</span><span class="number">1</span><span class="string">D434</span><span class="operator">}</span><span class="operator">-\x</span><span class="operator">{</span><span class="number">1</span><span class="string">D467</span><span class="operator">}]</span><span class="operator">/</span>
</code></pre>

<h2 id="Get-character-name-by-number">&#x211E; 6: Get character name by number</h2>

<pre><code> <span class="keyword">use</span> <span class="variable">charnames</span> <span class="operator">();</span>
 <span class="keyword">my</span> <span class="variable">$name</span> <span class="operator">=</span> <span class="variable">charnames::viacode</span><span class="operator">(</span><span class="number">0x03A3</span><span class="operator">);</span>
</code></pre>

<h2 id="Get-character-number-by-name">&#x211E; 7: Get character number by name</h2>

<pre><code> <span class="keyword">use</span> <span class="variable">charnames</span> <span class="operator">();</span>
 <span class="keyword">my</span> <span class="variable">$number</span> <span class="operator">=</span> <span class="variable">charnames::vianame</span><span class="operator">(</span><span class="string">"GREEK CAPITAL LETTER SIGMA"</span><span class="operator">);</span>
</code></pre>

<h2 id="Unicode-named-characters">&#x211E; 8: Unicode named characters</h2>

<p>Use the <code><span class="operator">\</span><span class="variable">N</span><span class="operator">{</span>
<i>charname</i>}</code> notation to get the character by that name for use in interpolated literals (double-quoted strings and regexes). In v5.16, there is an implicit</p>

<pre><code> <span class="keyword">use</span> <span class="variable">charnames</span> <span class="string">qw(:full :short)</span><span class="operator">;</span>
</code></pre>

<p>But prior to v5.16, you must be explicit about which set of charnames you want. The <code>:full</code> names are the official Unicode character name, alias, or sequence, which all share a namespace.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">charnames</span> <span class="string">qw(:full :short latin greek)</span><span class="operator">;</span>
 
 <span class="string">"\N{MATHEMATICAL ITALIC SMALL N}"</span>      <span class="comment"># :full</span>
 <span class="string">"\N{GREEK CAPITAL LETTER SIGMA}"</span>       <span class="comment"># :full</span>
</code></pre>

<p>Anything else is a Perl-specific convenience abbreviation. Specify one or more scripts by names if you want short names that are script-specific.</p>

<pre><code> <span class="string">"\N{Greek:Sigma}"</span>                      <span class="comment"># :short</span>
 <span class="string">"\N{ae}"</span>                               <span class="comment">#  latin</span>
 <span class="string">"\N{epsilon}"</span>                          <span class="comment">#  greek</span>
</code></pre>

<p>The v5.16 release also supports a <code>:loose</code> import for loose matching of character names, which works just like loose matching of property names: that is, it disregards case, whitespace, and underscores:</p>

<pre><code> <span class="string">"\N{euro sign}"</span>                        <span class="comment"># :loose (from v5.16)</span>
</code></pre>

<h2 id="Unicode-named-sequences">&#x211E; 9: Unicode named sequences</h2>

<p>These look just like character names but return multiple codepoints. Notice the <code>%vx</code> vector-print functionality in <code>printf</code>.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">charnames</span> <span class="string">qw(:full)</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$seq</span> <span class="operator">=</span> <span class="string">"\N{LATIN CAPITAL LETTER A WITH MACRON AND GRAVE}"</span><span class="operator">;</span>
 <span class="keyword">printf</span> <span class="string">"U+%v04X\n"</span><span class="operator">,</span> <span class="variable">$seq</span><span class="operator">;</span>
 <span class="variable">U</span><span class="operator">+</span><span class="number">0100</span><span class="operator">.</span><span class="number">0300</span>
</code></pre>

<h2 id="Custom-named-characters">&#x211E; 10: Custom named characters</h2>

<p>Use <code>:alias</code> to give your own lexically scoped nicknames to existing characters, or even to give unnamed private-use characters useful names.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">charnames</span> <span class="string">":full"</span><span class="operator">,</span> <span class="string">":alias"</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
     <span class="string">ecute</span> <span class="operator">=&gt;</span> <span class="string">"LATIN SMALL LETTER E WITH ACUTE"</span><span class="operator">,</span>
     <span class="string">"APPLE LOGO"</span> <span class="operator">=&gt;</span> <span class="number">0xF8FF</span><span class="operator">,</span> <span class="comment"># private use character</span>
 <span class="operator">}</span><span class="operator">;</span>
 
 <span class="string">"\N{ecute}"</span>
 <span class="string">"\N{APPLE LOGO}"</span>
</code></pre>

<h2 id="Names-of-CJK-codepoints">&#x211E; 11: Names of CJK codepoints</h2>

<p>Sinograms like &ldquo;&#x6771;&#x4EAC;&rdquo; come back with character names of <code>CJK UNIFIED IDEOGRAPH-6771</code> and <code>CJK UNIFIED IDEOGRAPH-4EAC</code>, because their &ldquo;names&rdquo; vary. The CPAN <code>Unicode::Unihan</code> module has a large database for decoding these (and a whole lot more), provided you know how to understand its output.</p>

<pre><code> <span class="comment"># cpan -i Unicode::Unihan</span>
 <span class="keyword">use</span> <span class="variable">Unicode::Unihan</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$str</span> <span class="operator">=</span> <span class="string">"æ±äº¬"</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$unhan</span> <span class="operator">=</span> <span class="variable">Unicode::Unihan</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">;</span>
 <span class="keyword">for</span> <span class="keyword">my</span> <span class="variable">$lang</span> <span class="operator">(</span><span class="string">qw(Mandarin Cantonese Korean JapaneseOn JapaneseKun)</span><span class="operator">)</span> <span class="operator">{</span>
     <span class="keyword">printf</span> <span class="string">"CJK </span><span class="variable">$str</span><span class="string"> in %-12s is "</span><span class="operator">,</span> <span class="variable">$lang</span><span class="operator">;</span>
     <span class="keyword">say</span> <span class="variable">$unhan</span><span class="operator">-&gt;</span><span class="variable">$lang</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">);</span>
 <span class="operator">}</span>
</code></pre>

<p>prints:</p>

<pre><code> CJK &#x6771;&#x4EAC; in Mandarin     is DONG1JING1
 CJK &#x6771;&#x4EAC; in Cantonese    is dung1ging1
 CJK &#x6771;&#x4EAC; in Korean       is TONGKYENG
 CJK &#x6771;&#x4EAC; in JapaneseOn   is TOUKYOU KEI KIN
 CJK &#x6771;&#x4EAC; in JapaneseKun  is HIGASHI AZUMAMIYAKO</code></pre>

<p>If you have a specific romanization scheme in mind, use the specific module:</p>

<pre><code> <span class="comment"># cpan -i Lingua::JA::Romanize::Japanese</span>
 <span class="keyword">use</span> <span class="variable">Lingua::JA::Romanize::Japanese</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$k2r</span> <span class="operator">=</span> <span class="variable">Lingua::JA::Romanize::Japanese</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$str</span> <span class="operator">=</span> <span class="string">"æ±äº¬"</span><span class="operator">;</span>
 <span class="keyword">say</span> <span class="string">"Japanese for </span><span class="variable">$str</span><span class="string"> is "</span><span class="operator">,</span> <span class="variable">$k2r</span><span class="operator">-&gt;</span><span class="variable">chars</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">);</span>
</code></pre>

<p>prints</p>

<pre><code> Japanese for &#x6771;&#x4EAC; is toukyou</code></pre>

<h2 id="Explicit-encode-decode">&#x211E; 12: Explicit encode/decode</h2>

<p>On rare occasion, such as a database read, you may be given encoded text you need to decode.</p>

<pre><code>  <span class="keyword">use</span> <span class="variable">Encode</span> <span class="string">qw(encode decode)</span><span class="operator">;</span>
  
  <span class="keyword">my</span> <span class="variable">$chars</span> <span class="operator">=</span> <span class="variable">decode</span><span class="operator">(</span><span class="string">"shiftjis"</span><span class="operator">,</span> <span class="variable">$bytes</span><span class="operator">,</span> <span class="number">1</span><span class="operator">);</span>
   <span class="comment"># OR</span>
  <span class="keyword">my</span> <span class="variable">$bytes</span> <span class="operator">=</span> <span class="variable">encode</span><span class="operator">(</span><span class="string">"MIME-Header-ISO_2022_JP"</span><span class="operator">,</span> <span class="variable">$chars</span><span class="operator">,</span> <span class="number">1</span><span class="operator">);</span>
</code></pre>

<p>For streams all in the same encoding, don&#39;t use encode/decode; instead set the file encoding when you open the file or immediately after with <code>binmode</code> as described later below.</p>

<h2 id="Decode-program-arguments-as-utf8">&#x211E; 13: Decode program arguments as utf8</h2>

<pre><code>     <span class="operator">$ </span><span class="variable">perl</span> <span class="operator">-</span><span class="variable">CA</span> <span class="operator">...</span>
      <span class="keyword">or</span>
     <span class="operator">$ </span><span class="variable">export</span> <span class="variable">PERL_UNICODE</span><span class="operator">=</span><span class="variable">A</span>
      <span class="keyword">or</span>
         <span class="keyword">use</span> <span class="variable">Encode</span> <span class="string">qw(decode)</span><span class="operator">;</span>
         <span class="variable">@ARGV</span> <span class="operator">=</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="variable">decode</span><span class="operator">(</span><span class="string">'UTF-8'</span><span class="operator">,</span> <span class="variable">$_</span><span class="operator">,</span> <span class="number">1</span><span class="operator">)</span> <span class="operator">}</span> <span class="variable">@ARGV</span><span class="operator">;</span>
</code></pre>

<h2 id="Decode-program-arguments-as-locale-encoding">&#x211E; 14: Decode program arguments as locale encoding</h2>

<pre><code>    <span class="comment"># cpan -i Encode::Locale</span>
    <span class="keyword">use</span> <span class="variable">Encode</span> <span class="string">qw(locale)</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">Encode::Locale</span><span class="operator">;</span>
    
    <span class="comment"># use "locale" as an arg to encode/decode</span>
    <span class="variable">@ARGV</span> <span class="operator">=</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="variable">decode</span><span class="operator">(</span><span class="string">locale</span> <span class="operator">=&gt;</span> <span class="variable">$_</span><span class="operator">,</span> <span class="number">1</span><span class="operator">)</span> <span class="operator">}</span> <span class="variable">@ARGV</span><span class="operator">;</span>
</code></pre>

<h2 id="Declare-STD-IN-OUT-ERR-to-be-utf8">&#x211E; 15: Declare STD{IN,OUT,ERR} to be utf8</h2>

<p>Use a command-line option, an environment variable, or else call <code>binmode</code> explicitly:</p>

<pre><code>     <span class="operator">$ </span><span class="variable">perl</span> <span class="operator">-</span><span class="variable">CS</span> <span class="operator">...</span>
      <span class="keyword">or</span>
     <span class="operator">$ </span><span class="variable">export</span> <span class="variable">PERL_UNICODE</span><span class="operator">=</span><span class="variable">S</span>
      <span class="keyword">or</span>
     <span class="keyword">use</span> <span class="keyword">open</span> <span class="string">qw(:std :encoding(UTF-8))</span><span class="operator">;</span>
      <span class="keyword">or</span>
     <span class="keyword">binmode</span><span class="operator">(</span><span class="variable">STDIN</span><span class="operator">,</span>  <span class="string">":encoding(UTF-8)"</span><span class="operator">);</span>
     <span class="keyword">binmode</span><span class="operator">(</span><span class="variable">STDOUT</span><span class="operator">,</span> <span class="string">":utf8"</span><span class="operator">);</span>
     <span class="keyword">binmode</span><span class="operator">(</span><span class="variable">STDERR</span><span class="operator">,</span> <span class="string">":utf8"</span><span class="operator">);</span>
</code></pre>

<h2 id="Declare-STD-IN-OUT-ERR-to-be-in-locale-encoding">&#x211E; 16: Declare STD{IN,OUT,ERR} to be in locale encoding</h2>

<pre><code>    <span class="comment"># cpan -i Encode::Locale</span>
    <span class="keyword">use</span> <span class="variable">Encode</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">Encode::Locale</span><span class="operator">;</span>
    
    <span class="comment"># or as a stream for binmode or open</span>
    <span class="keyword">binmode</span> <span class="variable">STDIN</span><span class="operator">,</span>  <span class="string">":encoding(console_in)"</span>  <span class="keyword">if</span> <span class="keyword">-t</span> <span class="variable">STDIN</span><span class="operator">;</span>
    <span class="keyword">binmode</span> <span class="variable">STDOUT</span><span class="operator">,</span> <span class="string">":encoding(console_out)"</span> <span class="keyword">if</span> <span class="keyword">-t</span> <span class="variable">STDOUT</span><span class="operator">;</span>
    <span class="keyword">binmode</span> <span class="variable">STDERR</span><span class="operator">,</span> <span class="string">":encoding(console_out)"</span> <span class="keyword">if</span> <span class="keyword">-t</span> <span class="variable">STDERR</span><span class="operator">;</span>
</code></pre>

<h2 id="Make-file-I-O-default-to-utf8">&#x211E; 17: Make file I/O default to utf8</h2>

<p>Files opened without an encoding argument will be in UTF-8:</p>

<pre><code>     <span class="operator">$ </span><span class="variable">perl</span> <span class="operator">-</span><span class="variable">CD</span> <span class="operator">...</span>
      <span class="keyword">or</span>
     <span class="operator">$ </span><span class="variable">export</span> <span class="variable">PERL_UNICODE</span><span class="operator">=</span><span class="variable">D</span>
      <span class="keyword">or</span>
     <span class="keyword">use</span> <span class="keyword">open</span> <span class="string">qw(:encoding(UTF-8))</span><span class="operator">;</span>
</code></pre>

<h2 id="Make-all-I-O-and-args-default-to-utf8">&#x211E; 18: Make all I/O and args default to utf8</h2>

<pre><code>     <span class="operator">$ </span><span class="variable">perl</span> <span class="operator">-</span><span class="variable">CSDA</span> <span class="operator">...</span>
      <span class="keyword">or</span>
     <span class="operator">$ </span><span class="variable">export</span> <span class="variable">PERL_UNICODE</span><span class="operator">=</span><span class="variable">SDA</span>
      <span class="keyword">or</span>
     <span class="keyword">use</span> <span class="keyword">open</span> <span class="string">qw(:std :encoding(UTF-8))</span><span class="operator">;</span>
     <span class="keyword">use</span> <span class="variable">Encode</span> <span class="string">qw(decode)</span><span class="operator">;</span>
     <span class="variable">@ARGV</span> <span class="operator">=</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="variable">decode</span><span class="operator">(</span><span class="string">'UTF-8'</span><span class="operator">,</span> <span class="variable">$_</span><span class="operator">,</span> <span class="number">1</span><span class="operator">)</span> <span class="operator">}</span> <span class="variable">@ARGV</span><span class="operator">;</span>
</code></pre>

<h2 id="Open-file-with-specific-encoding">&#x211E; 19: Open file with specific encoding</h2>

<p>Specify stream encoding. This is the normal way to deal with encoded text, not by calling low-level functions.</p>

<pre><code> <span class="comment"># input file</span>
     <span class="keyword">open</span><span class="operator">(</span><span class="keyword">my</span> <span class="variable">$in_file</span><span class="operator">,</span> <span class="string">"&lt; :encoding(UTF-16)"</span><span class="operator">,</span> <span class="string">"wintext"</span><span class="operator">);</span>
 <span class="variable">OR</span>
     <span class="keyword">open</span><span class="operator">(</span><span class="keyword">my</span> <span class="variable">$in_file</span><span class="operator">,</span> <span class="string">"&lt;"</span><span class="operator">,</span> <span class="string">"wintext"</span><span class="operator">);</span>
     <span class="keyword">binmode</span><span class="operator">(</span><span class="variable">$in_file</span><span class="operator">,</span> <span class="string">":encoding(UTF-16)"</span><span class="operator">);</span>
 <span class="variable">THEN</span>
     <span class="keyword">my</span> <span class="variable">$line</span> <span class="operator">=</span> <span class="operator">&lt;</span><span class="variable">$in_file</span><span class="operator">&gt;;</span>
 
 <span class="comment"># output file</span>
     <span class="keyword">open</span><span class="operator">(</span><span class="variable">$out_file</span><span class="operator">,</span> <span class="string">"&gt; :encoding(cp1252)"</span><span class="operator">,</span> <span class="string">"wintext"</span><span class="operator">);</span>
 <span class="variable">OR</span>
     <span class="keyword">open</span><span class="operator">(</span><span class="keyword">my</span> <span class="variable">$out_file</span><span class="operator">,</span> <span class="string">"&gt;"</span><span class="operator">,</span> <span class="string">"wintext"</span><span class="operator">);</span>
     <span class="keyword">binmode</span><span class="operator">(</span><span class="variable">$out_file</span><span class="operator">,</span> <span class="string">":encoding(cp1252)"</span><span class="operator">);</span>
 <span class="variable">THEN</span>
     <span class="keyword">print</span> <span class="variable">$out_file</span> <span class="string">"some text\n"</span><span class="operator">;</span>
</code></pre>

<p>More layers than just the encoding can be specified here. For example, the incantation <code>&quot;:raw :encoding(UTF-16LE) :crlf&quot;</code> includes implicit CRLF handling.</p>

<h2 id="Unicode-casing">&#x211E; 20: Unicode casing</h2>

<p>Unicode casing is very different from ASCII casing.</p>

<pre><code> uc(&quot;henry &#x2177;&quot;)  # &quot;HENRY &#x2167;&quot;
 uc(&quot;tsch&uuml;&szlig;&quot;)   # &quot;TSCH&Uuml;SS&quot;  notice &szlig; =&gt; SS

 # both are true:
 &quot;tsch&uuml;&szlig;&quot;  =~ /TSCH&Uuml;SS/i   # notice &szlig; =&gt; SS
 &quot;&Sigma;&#x3AF;&sigma;&upsilon;&phi;&omicron;&sigmaf;&quot; =~ /&Sigma;&#x38A;&Sigma;&Upsilon;&Phi;&Omicron;&Sigma;/i   # notice &Sigma;,&sigma;,&sigmaf; sameness</code></pre>

<h2 id="Unicode-case-insensitive-comparisons">&#x211E; 21: Unicode case-insensitive comparisons</h2>

<p>Also available in the CPAN <a>Unicode::CaseFold</a> module, the new <code>fc</code> &ldquo;foldcase&rdquo; function from v5.16 grants access to the same Unicode casefolding as the <code>/i</code> pattern modifier has always used:</p>

<pre><code> <span class="keyword">use</span> <span class="variable">feature</span> <span class="string">"fc"</span><span class="operator">;</span> <span class="comment"># fc() function is from v5.16</span>
 
 <span class="comment"># sort case-insensitively</span>
 <span class="keyword">my</span> <span class="variable">@sorted</span> <span class="operator">=</span> <span class="keyword">sort</span> <span class="operator">{</span> <span class="variable">fc</span><span class="operator">(</span><span class="variable">$a</span><span class="operator">)</span> <span class="keyword">cmp</span> <span class="variable">fc</span><span class="operator">(</span><span class="variable">$b</span><span class="operator">)</span> <span class="operator">}</span> <span class="variable">@list</span><span class="operator">;</span>
 
 <span class="comment"># both are true:</span>
 <span class="variable">fc</span><span class="operator">(</span><span class="string">"tschÃ¼Ã"</span><span class="operator">)</span>  <span class="keyword">eq</span> <span class="variable">fc</span><span class="operator">(</span><span class="string">"TSCHÃSS"</span><span class="operator">)</span>
 <span class="variable">fc</span><span class="operator">(</span><span class="string">"Î£Î¯ÏÏÏÎ¿Ï"</span><span class="operator">)</span> <span class="keyword">eq</span> <span class="variable">fc</span><span class="operator">(</span><span class="string">"Î£ÎÎ£Î¥Î¦ÎÎ£"</span><span class="operator">)</span>
</code></pre>

<h2 id="Match-Unicode-linebreak-sequence-in-regex">&#x211E; 22: Match Unicode linebreak sequence in regex</h2>

<p>A Unicode linebreak matches the two-character CRLF grapheme or any of seven vertical whitespace characters. Good for dealing with textfiles coming from different operating systems.</p>

<pre><code> <span class="operator">\</span><span class="variable">R</span>
 
 <span class="regex">s/\R/\n/g</span><span class="operator">;</span>  <span class="comment"># normalize all linebreaks to \n</span>
</code></pre>

<h2 id="Get-character-category">&#x211E; 23: Get character category</h2>

<p>Find the general category of a numeric codepoint.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">Unicode::UCD</span> <span class="string">qw(charinfo)</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$cat</span> <span class="operator">=</span> <span class="variable">charinfo</span><span class="operator">(</span><span class="number">0x3A3</span><span class="operator">)-&gt;</span><span class="operator">{</span><span class="string">category</span><span class="operator">}</span><span class="operator">;</span>  <span class="comment"># "Lu"</span>
</code></pre>

<h2 id="Disabling-Unicode-awareness-in-builtin-charclasses">&#x211E; 24: Disabling Unicode-awareness in builtin charclasses</h2>

<p>Disable <code>\w</code>, <code>\b</code>, <code>\s</code>, <code>\d</code>, and the POSIX classes from working correctly on Unicode either in this scope, or in just one regex.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">v5</span><span class="number">.14</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">re</span> <span class="string">"/a"</span><span class="operator">;</span>
 
 <span class="comment"># OR</span>
 
 <span class="keyword">my</span><span class="operator">(</span><span class="variable">$num</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$str</span> <span class="operator">=~</span> <span class="regex">/(\d+)/a</span><span class="operator">;</span>
</code></pre>

<p>Or use specific un-Unicode properties, like <code><span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">ahex</span><span class="operator">}</span>
</code> and <code><span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">POSIX_Digit</span>
</code>}. Properties still work normally no matter what charset modifiers (<code>/d /u /l /a /aa</code>) should be effect.</p>

<h2 id="Match-Unicode-properties-in-regex-with-p-P">&#x211E; 25: Match Unicode properties in regex with \p, \P</h2>

<p>These all match a single codepoint with the given property. Use <code>\P</code> in place of <code>\p</code> to match one codepoint lacking that property.</p>

<pre><code> <span class="operator">\</span><span class="variable">pL</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">pN</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">pS</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">pP</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">pM</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">pZ</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">pC</span>
 <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">Sk</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">Ps</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">Lt</span><span class="operator">}</span>
 <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">alpha</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">upper</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">lower</span><span class="operator">}</span>
 <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">Latin</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">Greek</span><span class="operator">}</span>
 <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">script_extensions</span><span class="operator">=</span><span class="variable">Latin</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">scx</span><span class="operator">=</span><span class="variable">Greek</span><span class="operator">}</span>
 <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">East_Asian_Width</span><span class="operator">=</span><span class="variable">Wide</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">EA</span><span class="operator">=</span><span class="variable">W</span><span class="operator">}</span>
 <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">Line_Break</span><span class="operator">=</span><span class="variable">Hyphen</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">LB</span><span class="operator">=</span><span class="variable">HY</span><span class="operator">}</span>
 <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">Numeric_Value</span><span class="operator">=</span><span class="number">4</span><span class="operator">},</span> <span class="operator">\</span><span class="variable">p</span><span class="operator">{</span><span class="variable">NV</span><span class="operator">=</span><span class="number">4</span><span class="operator">}</span>
</code></pre>

<h2 id="Custom-character-properties">&#x211E; 26: Custom character properties</h2>

<p>Define at compile-time your own custom character properties for use in regexes.</p>

<pre><code> <span class="comment"># using private-use characters</span>
 <span class="keyword">sub</span><span class="variable"> In_Tengwar </span><span class="operator">{</span> <span class="string">"E000\tE07F\n"</span> <span class="operator">}</span>
 
 <span class="keyword">if</span> <span class="operator">(</span><span class="regex">/\p{In_Tengwar}/</span><span class="operator">)</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
 
 <span class="comment"># blending existing properties</span>
 <span class="keyword">sub</span><span class="variable"> Is_GraecoRoman_Title </span><span class="operator">{&lt;&lt;</span><span class="default">'END_OF_SET'</span><span class="operator">}</span><span class="string">
 +utf8::IsLatin
 +utf8::IsGreek
 &amp;utf8::IsTitle
 </span><span class="default">END_OF_SET</span>
 
 <span class="keyword">if</span> <span class="operator">(</span><span class="regex">/\p{Is_GraecoRoman_Title}/</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
</code></pre>

<h2 id="Unicode-normalization">&#x211E; 27: Unicode normalization</h2>

<p>Typically render into NFD on input and NFC on output. Using NFKC or NFKD functions improves recall on searches, assuming you&#39;ve already done to the same text to be searched. Note that this is about much more than just pre- combined compatibility glyphs; it also reorders marks according to their canonical combining classes and weeds out singletons.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">Unicode::Normalize</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$nfd</span>  <span class="operator">=</span> <span class="variable">NFD</span><span class="operator">(</span><span class="variable">$orig</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">$nfc</span>  <span class="operator">=</span> <span class="variable">NFC</span><span class="operator">(</span><span class="variable">$orig</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">$nfkd</span> <span class="operator">=</span> <span class="variable">NFKD</span><span class="operator">(</span><span class="variable">$orig</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">$nfkc</span> <span class="operator">=</span> <span class="variable">NFKC</span><span class="operator">(</span><span class="variable">$orig</span><span class="operator">);</span>
</code></pre>

<h2 id="Convert-non-ASCII-Unicode-numerics">&#x211E; 28: Convert non-ASCII Unicode numerics</h2>

<p>Unless you&rsquo;ve used <code>/a</code> or <code>/aa</code>, <code>\d</code> matches more than ASCII digits only, but Perl&rsquo;s implicit string-to-number conversion does not current recognize these. Here&rsquo;s how to convert such strings manually.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">v5</span><span class="number">.14</span><span class="operator">;</span>  <span class="comment"># needed for num() function</span>
 <span class="keyword">use</span> <span class="variable">Unicode::UCD</span> <span class="string">qw(num)</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$str</span> <span class="operator">=</span> <span class="string">"got â« and à¥ªà¥«à¥¬à¥­ and â and here"</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">@nums</span> <span class="operator">=</span> <span class="operator">();</span>
 <span class="keyword">while</span> <span class="operator">(</span><span class="variable">$str</span> <span class="operator">=~</span> <span class="regex">/(\d+|\N)/g</span><span class="operator">)</span> <span class="operator">{</span>  <span class="comment"># not just ASCII!</span>
    <span class="keyword">push</span> <span class="variable">@nums</span><span class="operator">,</span> <span class="variable">num</span><span class="operator">(</span><span class="variable">$1</span><span class="operator">);</span>
 <span class="operator">}</span>
 <span class="keyword">say</span> <span class="string">"</span><span class="variable">@nums</span><span class="string">"</span><span class="operator">;</span>   <span class="comment">#     12      4567      0.875</span>
 
 <span class="keyword">use</span> <span class="variable">charnames</span> <span class="string">qw(:full)</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$nv</span> <span class="operator">=</span> <span class="variable">num</span><span class="operator">(</span><span class="string">"\N{RUMI DIGIT ONE}\N{RUMI DIGIT TWO}"</span><span class="operator">);</span>
</code></pre>

<h2 id="Match-Unicode-grapheme-cluster-in-regex">&#x211E; 29: Match Unicode grapheme cluster in regex</h2>

<p>Programmer-visible &ldquo;characters&rdquo; are codepoints matched by <code>/./s</code>, but user-visible &ldquo;characters&rdquo; are graphemes matched by <code>/\X/</code>.</p>

<pre><code> <span class="comment"># Find vowel *plus* any combining diacritics,underlining,etc.</span>
 <span class="keyword">my</span> <span class="variable">$nfd</span> <span class="operator">=</span> <span class="variable">NFD</span><span class="operator">(</span><span class="variable">$orig</span><span class="operator">);</span>
 <span class="variable">$nfd</span> <span class="operator">=~</span> <span class="regex">/ (?=[aeiou]) \X /xi</span>
</code></pre>

<h2 id="Extract-by-grapheme-instead-of-by-codepoint-regex">&#x211E; 30: Extract by grapheme instead of by codepoint (regex)</h2>

<pre><code> <span class="comment"># match and grab five first graphemes</span>
 <span class="keyword">my</span><span class="operator">(</span><span class="variable">$first_five</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$str</span> <span class="operator">=~</span> <span class="regex">/^ ( \X{5} ) /x</span><span class="operator">;</span>
</code></pre>

<h2 id="Extract-by-grapheme-instead-of-by-codepoint-substr">&#x211E; 31: Extract by grapheme instead of by codepoint (substr)</h2>

<pre><code> <span class="comment"># cpan -i Unicode::GCString</span>
 <span class="keyword">use</span> <span class="variable">Unicode::GCString</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$gcs</span> <span class="operator">=</span> <span class="variable">Unicode::GCString</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">$first_five</span> <span class="operator">=</span> <span class="variable">$gcs</span><span class="operator">-&gt;</span><span class="variable">substr</span><span class="operator">(</span><span class="number">0</span><span class="operator">,</span> <span class="number">5</span><span class="operator">);</span>
</code></pre>

<h2 id="Reverse-string-by-grapheme">&#x211E; 32: Reverse string by grapheme</h2>

<p>Reversing by codepoint messes up diacritics, mistakenly converting <code>cr&egrave;me br&ucirc;l&eacute;e</code> into <code>&eacute;el&#x302;urb em&#x300;erc</code> instead of into <code>e&eacute;l&ucirc;rb em&egrave;rc</code>; so reverse by grapheme instead. Both these approaches work right no matter what normalization the string is in:</p>

<pre><code> <span class="variable">$str</span> <span class="operator">=</span> <span class="keyword">join</span><span class="operator">(</span><span class="string">""</span><span class="operator">,</span> <span class="keyword">reverse</span> <span class="variable">$str</span> <span class="operator">=~</span> <span class="regex">/\X/g</span><span class="operator">);</span>
 
 <span class="comment"># OR: cpan -i Unicode::GCString</span>
 <span class="keyword">use</span> <span class="variable">Unicode::GCString</span><span class="operator">;</span>
 <span class="variable">$str</span> <span class="operator">=</span> <span class="keyword">reverse</span> <span class="variable">Unicode::GCString</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">);</span>
</code></pre>

<h2 id="String-length-in-graphemes">&#x211E; 33: String length in graphemes</h2>

<p>The string <code>br&ucirc;l&eacute;e</code> has six graphemes but up to eight codepoints. This counts by grapheme, not by codepoint:</p>

<pre><code> <span class="keyword">my</span> <span class="variable">$str</span> <span class="operator">=</span> <span class="string">"brÃ»lÃ©e"</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="number">0</span><span class="operator">;</span>
 <span class="keyword">while</span> <span class="operator">(</span><span class="variable">$str</span> <span class="operator">=~</span> <span class="regex">/\X/g</span><span class="operator">)</span> <span class="operator">{</span> <span class="variable">$count</span><span class="operator">++</span> <span class="operator">}</span>
 
  <span class="comment"># OR: cpan -i Unicode::GCString</span>
 <span class="keyword">use</span> <span class="variable">Unicode::GCString</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$gcs</span> <span class="operator">=</span> <span class="variable">Unicode::GCString</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="variable">$gcs</span><span class="operator">-&gt;</span><span class="variable">length</span><span class="operator">;</span>
</code></pre>

<h2 id="Unicode-column-width-for-printing">&#x211E; 34: Unicode column-width for printing</h2>

<p>Perl&rsquo;s <code>printf</code>, <code>sprintf</code>, and <code>format</code> think all codepoints take up 1 print column, but many take 0 or 2. Here to show that normalization makes no difference, we print out both forms:</p>

<pre><code> <span class="keyword">use</span> <span class="variable">Unicode::GCString</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">Unicode::Normalize</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">@words</span> <span class="operator">=</span> <span class="string">qw/crÃ¨me brÃ»lÃ©e/</span><span class="operator">;</span>
 <span class="variable">@words</span> <span class="operator">=</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="variable">NFC</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">),</span> <span class="variable">NFD</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">)</span> <span class="operator">}</span> <span class="variable">@words</span><span class="operator">;</span>
 
 <span class="keyword">for</span> <span class="keyword">my</span> <span class="variable">$str</span> <span class="operator">(</span><span class="variable">@words</span><span class="operator">)</span> <span class="operator">{</span>
     <span class="keyword">my</span> <span class="variable">$gcs</span> <span class="operator">=</span> <span class="variable">Unicode::GCString</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">);</span>
     <span class="keyword">my</span> <span class="variable">$cols</span> <span class="operator">=</span> <span class="variable">$gcs</span><span class="operator">-&gt;</span><span class="variable">columns</span><span class="operator">;</span>
     <span class="keyword">my</span> <span class="variable">$pad</span> <span class="operator">=</span> <span class="string">" "</span> <span class="operator">x</span> <span class="operator">(</span><span class="number">10</span> <span class="operator">-</span> <span class="variable">$cols</span><span class="operator">);</span>
     <span class="keyword">say</span> <span class="variable">str</span><span class="operator">,</span> <span class="variable">$pad</span><span class="operator">,</span> <span class="string">" |"</span><span class="operator">;</span>
 <span class="operator">}</span>
</code></pre>

<p>generates this to show that it pads correctly no matter the normalization:</p>

<pre><code> cr&egrave;me      |
 cre&#x300;me      |
 br&ucirc;l&eacute;e     |
 bru&#x302;le&#x301;e     |</code></pre>

<h2 id="Unicode-collation">&#x211E; 35: Unicode collation</h2>

<p>Text sorted by numeric codepoint follows no reasonable alphabetic order; use the UCA for sorting text.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">Unicode::Collate</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$col</span> <span class="operator">=</span> <span class="variable">Unicode::Collate</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="keyword">my</span> <span class="variable">@list</span> <span class="operator">=</span> <span class="variable">$col</span><span class="operator">-&gt;</span><span class="variable">sort</span><span class="operator">(</span><span class="variable">@old_list</span><span class="operator">);</span>
</code></pre>

<p>See the <i>ucsort</i> program from the <a>Unicode::Tussle</a> CPAN module for a convenient command-line interface to this module.</p>

<h2 id="Case--and-accent-insensitive-Unicode-sort">&#x211E; 36: Case- <i>and</i> accent-insensitive Unicode sort</h2>

<p>Specify a collation strength of level 1 to ignore case and diacritics, only looking at the basic character.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">Unicode::Collate</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$col</span> <span class="operator">=</span> <span class="variable">Unicode::Collate</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">level</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@list</span> <span class="operator">=</span> <span class="variable">$col</span><span class="operator">-&gt;</span><span class="variable">sort</span><span class="operator">(</span><span class="variable">@old_list</span><span class="operator">);</span>
</code></pre>

<h2 id="Unicode-locale-collation">&#x211E; 37: Unicode locale collation</h2>

<p>Some locales have special sorting rules.</p>

<pre><code> <span class="comment"># either use v5.12, OR: cpan -i Unicode::Collate::Locale</span>
 <span class="keyword">use</span> <span class="variable">Unicode::Collate::Locale</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$col</span> <span class="operator">=</span> <span class="variable">Unicode::Collate::Locale</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">locale</span> <span class="operator">=&gt;</span> <span class="string">"de__phonebook"</span><span class="operator">);</span>
 <span class="keyword">my</span> <span class="variable">@list</span> <span class="operator">=</span> <span class="variable">$col</span><span class="operator">-&gt;</span><span class="variable">sort</span><span class="operator">(</span><span class="variable">@old_list</span><span class="operator">);</span>
</code></pre>

<p>The <i>ucsort</i> program mentioned above accepts a <code>--locale</code> parameter.</p>

<h2 id="Making-cmp-work-on-text-instead-of-codepoints">&#x211E; 38: Making <code>cmp</code> work on text instead of codepoints</h2>

<p>Instead of this:</p>

<pre><code> <span class="variable">@srecs</span> <span class="operator">=</span> <span class="keyword">sort</span> <span class="operator">{</span>
     <span class="variable">$b</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AGE</span><span class="operator">}</span>   <span class="operator">&lt;=&gt;</span>  <span class="variable">$a</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AGE</span><span class="operator">}</span>
                 <span class="operator">||</span>
     <span class="variable">$a</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NAME</span><span class="operator">}</span>  <span class="keyword">cmp</span>  <span class="variable">$b</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NAME</span><span class="operator">}</span>
 <span class="operator">}</span> <span class="variable">@recs</span><span class="operator">;</span>
</code></pre>

<p>Use this:</p>

<pre><code> <span class="keyword">my</span> <span class="variable">$coll</span> <span class="operator">=</span> <span class="variable">Unicode::Collate</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
 <span class="keyword">for</span> <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">(</span><span class="variable">@recs</span><span class="operator">)</span> <span class="operator">{</span>
     <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NAME_key</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$coll</span><span class="operator">-&gt;</span><span class="variable">getSortKey</span><span class="operator">(</span> <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NAME</span><span class="operator">}</span> <span class="operator">);</span>
 <span class="operator">}</span>
 <span class="variable">@srecs</span> <span class="operator">=</span> <span class="keyword">sort</span> <span class="operator">{</span>
     <span class="variable">$b</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AGE</span><span class="operator">}</span>       <span class="operator">&lt;=&gt;</span>  <span class="variable">$a</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AGE</span><span class="operator">}</span>
                     <span class="operator">||</span>
     <span class="variable">$a</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NAME_key</span><span class="operator">}</span>  <span class="keyword">cmp</span>  <span class="variable">$b</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NAME_key</span><span class="operator">}</span>
 <span class="operator">}</span> <span class="variable">@recs</span><span class="operator">;</span>
</code></pre>

<h2 id="Case--and-accent-insensitive-comparisons">&#x211E; 39: Case- <i>and</i> accent-insensitive comparisons</h2>

<p>Use a collator object to compare Unicode text by character instead of by codepoint.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">Unicode::Collate</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$es</span> <span class="operator">=</span> <span class="variable">Unicode::Collate</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span>
     <span class="string">level</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>
     <span class="string">normalization</span> <span class="operator">=&gt;</span> <span class="keyword">undef</span>
 <span class="operator">);</span>
 
  <span class="comment"># now both are true:</span>
 <span class="variable">$es</span><span class="operator">-&gt;</span><span class="variable">eq</span><span class="operator">(</span><span class="string">"GarcÃ­a"</span><span class="operator">,</span>  <span class="string">"GARCIA"</span> <span class="operator">);</span>
 <span class="variable">$es</span><span class="operator">-&gt;</span><span class="variable">eq</span><span class="operator">(</span><span class="string">"MÃ¡rquez"</span><span class="operator">,</span> <span class="string">"MARQUEZ"</span><span class="operator">);</span>
</code></pre>

<h2 id="Case--and-accent-insensitive-locale-comparisons">&#x211E; 40: Case- <i>and</i> accent-insensitive locale comparisons</h2>

<p>Same, but in a specific locale.</p>

<pre><code> <span class="keyword">my</span> <span class="variable">$de</span> <span class="operator">=</span> <span class="variable">Unicode::Collate::Locale</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span>
            <span class="string">locale</span> <span class="operator">=&gt;</span> <span class="string">"de__phonebook"</span><span class="operator">,</span>
          <span class="operator">);</span>
 
 <span class="comment"># now this is true:</span>
 <span class="variable">$de</span><span class="operator">-&gt;</span><span class="variable">eq</span><span class="operator">(</span><span class="string">"tschÃ¼Ã"</span><span class="operator">,</span> <span class="string">"TSCHUESS"</span><span class="operator">);</span>  <span class="comment"># notice Ã¼ =&gt; UE, Ã =&gt; SS</span>
</code></pre>

<h2 id="Unicode-linebreaking">&#x211E; 41: Unicode linebreaking</h2>

<p>Break up text into lines according to Unicode rules.</p>

<pre><code> <span class="comment"># cpan -i Unicode::LineBreak</span>
 <span class="keyword">use</span> <span class="variable">Unicode::LineBreak</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">charnames</span> <span class="string">qw(:full)</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$para</span> <span class="operator">=</span> <span class="string">"This is a super\N{HYPHEN}long string. "</span> <span class="operator">x</span> <span class="number">20</span><span class="operator">;</span>
 <span class="keyword">my</span> <span class="variable">$fmt</span> <span class="operator">=</span> <span class="variable">Unicode::LineBreak</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">;</span>
 <span class="keyword">print</span> <span class="variable">$fmt</span><span class="operator">-&gt;</span><span class="variable">break</span><span class="operator">(</span><span class="variable">$para</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">;</span>
</code></pre>

<h2 id="Unicode-text-in-DBM-hashes-the-tedious-way">&#x211E; 42: Unicode text in DBM hashes, the tedious way</h2>

<p>Using a regular Perl string as a key or value for a DBM hash will trigger a wide character exception if any codepoints won&rsquo;t fit into a byte. Here&rsquo;s how to manually manage the translation:</p>

<pre><code>    <span class="keyword">use</span> <span class="variable">DB_File</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">Encode</span> <span class="string">qw(encode decode)</span><span class="operator">;</span>
    <span class="keyword">tie</span> <span class="variable">%dbhash</span><span class="operator">,</span> <span class="string">"DB_File"</span><span class="operator">,</span> <span class="string">"pathname"</span><span class="operator">;</span>
    
     <span class="comment"># STORE</span>
    
    <span class="comment"># assume $uni_key and $uni_value are abstract Unicode strings</span>
    <span class="keyword">my</span> <span class="variable">$enc_key</span>   <span class="operator">=</span> <span class="variable">encode</span><span class="operator">(</span><span class="string">"UTF-8"</span><span class="operator">,</span> <span class="variable">$uni_key</span><span class="operator">,</span> <span class="number">1</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$enc_value</span> <span class="operator">=</span> <span class="variable">encode</span><span class="operator">(</span><span class="string">"UTF-8"</span><span class="operator">,</span> <span class="variable">$uni_value</span><span class="operator">,</span> <span class="number">1</span><span class="operator">);</span>
    <span class="variable">$dbhash</span><span class="operator">{</span><span class="variable">$enc_key</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$enc_value</span><span class="operator">;</span>
    
     <span class="comment"># FETCH</span>
    
    <span class="comment"># assume $uni_key holds a normal Perl string (abstract Unicode)</span>
    <span class="keyword">my</span> <span class="variable">$enc_key</span>   <span class="operator">=</span> <span class="variable">encode</span><span class="operator">(</span><span class="string">"UTF-8"</span><span class="operator">,</span> <span class="variable">$uni_key</span><span class="operator">,</span> <span class="number">1</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$enc_value</span> <span class="operator">=</span> <span class="variable">$dbhash</span><span class="operator">{</span><span class="variable">$enc_key</span><span class="operator">}</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$uni_value</span> <span class="operator">=</span> <span class="variable">decode</span><span class="operator">(</span><span class="string">"UTF-8"</span><span class="operator">,</span> <span class="variable">$enc_value</span><span class="operator">,</span> <span class="number">1</span><span class="operator">);</span>
</code></pre>

<h2 id="Unicode-text-in-DBM-hashes-the-easy-way">&#x211E; 43: Unicode text in DBM hashes, the easy way</h2>

<p>Here&rsquo;s how to implicitly manage the translation; all encoding and decoding is done automatically, just as with streams that have a particular encoding attached to them:</p>

<pre><code>    <span class="keyword">use</span> <span class="variable">DB_File</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">DBM_Filter</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">$dbobj</span> <span class="operator">=</span> <span class="keyword">tie</span> <span class="variable">%dbhash</span><span class="operator">,</span> <span class="string">"DB_File"</span><span class="operator">,</span> <span class="string">"pathname"</span><span class="operator">;</span>
    <span class="variable">$dbobj</span><span class="operator">-&gt;</span><span class="variable">Filter_Value</span><span class="operator">(</span><span class="string">"utf8"</span><span class="operator">);</span>  <span class="comment"># this is the magic bit</span>
    
     <span class="comment"># STORE</span>
    
    <span class="comment"># assume $uni_key and $uni_value are abstract Unicode strings</span>
    <span class="variable">$dbhash</span><span class="operator">{</span><span class="variable">$uni_key</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$uni_value</span><span class="operator">;</span>
    
      <span class="comment"># FETCH</span>
    
    <span class="comment"># $uni_key holds a normal Perl string (abstract Unicode)</span>
    <span class="keyword">my</span> <span class="variable">$uni_value</span> <span class="operator">=</span> <span class="variable">$dbhash</span><span class="operator">{</span><span class="variable">$uni_key</span><span class="operator">}</span><span class="operator">;</span>
</code></pre>

<h2 id="PROGRAM:-Demo-of-Unicode-collation-and-printing">&#x211E; 44: PROGRAM: Demo of Unicode collation and printing</h2>

<p>Here&rsquo;s a full program showing how to make use of locale-sensitive sorting, Unicode casing, and managing print widths when some of the characters take up zero or two columns, not just one column each time. When run, the following program produces this nicely aligned output:</p>

<pre><code>    Cr&egrave;me Br&ucirc;l&eacute;e....... &euro;2.00
    &Eacute;clair............. &euro;1.60
    Fideu&agrave;............. &euro;4.20
    Hamburger.......... &euro;6.00
    Jam&oacute;n Serrano...... &euro;4.45
    Lingui&ccedil;a........... &euro;7.00
    P&acirc;t&eacute;............... &euro;4.15
    Pears.............. &euro;2.00
    P&ecirc;ches............. &euro;2.25
    Sm&oslash;rbr&oslash;d........... &euro;5.75
    Sp&auml;tzle............ &euro;5.50
    Xori&ccedil;o............. &euro;3.00
    &Gamma;&#x3CD;&rho;&omicron;&sigmaf;.............. &euro;6.50
    &#xB9C9;&#xAC78;&#xB9AC;............. &euro;4.00
    &#x304A;&#x3082;&#x3061;............. &euro;2.65
    &#x304A;&#x597D;&#x307F;&#x713C;&#x304D;......... &euro;8.00
    &#x30B7;&#x30E5;&#x30FC;&#x30AF;&#x30EA;&#x30FC;&#x30E0;..... &euro;1.85
    &#x5BFF;&#x53F8;............... &euro;9.99
    &#x5305;&#x5B50;............... &euro;7.50</code></pre>

<p>Here&#39;s that program; tested on v5.14.</p>

<pre><code> <span class="comment">#!/usr/bin/env perl</span>
 <span class="comment"># umenu - demo sorting and printing of Unicode food</span>
 <span class="comment">#</span>
 <span class="comment"># (obligatory and increasingly long preamble)</span>
 <span class="comment">#</span>
 <span class="keyword">use</span> <span class="variable">utf8</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">v5</span><span class="number">.14</span><span class="operator">;</span>                       <span class="comment"># for locale sorting</span>
 <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">warnings</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">warnings</span>  <span class="string">qw(FATAL utf8)</span><span class="operator">;</span>    <span class="comment"># fatalize encoding faults</span>
 <span class="keyword">use</span> <span class="keyword">open</span>      <span class="string">qw(:std :encoding(UTF-8))</span><span class="operator">;</span> <span class="comment"># undeclared streams in UTF-8</span>
 <span class="keyword">use</span> <span class="variable">charnames</span> <span class="string">qw(:full :short)</span><span class="operator">;</span>  <span class="comment"># unneeded in v5.16</span>
 
 <span class="comment"># std modules</span>
 <span class="keyword">use</span> <span class="variable">Unicode::Normalize</span><span class="operator">;</span>          <span class="comment"># std perl distro as of v5.8</span>
 <span class="keyword">use</span> <span class="variable">List::Util</span> <span class="string">qw(max)</span><span class="operator">;</span>          <span class="comment"># std perl distro as of v5.10</span>
 <span class="keyword">use</span> <span class="variable">Unicode::Collate::Locale</span><span class="operator">;</span>    <span class="comment"># std perl distro as of v5.14</span>
 
 <span class="comment"># cpan modules</span>
 <span class="keyword">use</span> <span class="variable">Unicode::GCString</span><span class="operator">;</span>           <span class="comment"># from CPAN</span>
 
 <span class="comment"># forward defs</span>
 <span class="keyword">sub</span><span class="variable"> pad</span><span class="operator">(</span>$$$<span class="operator">);</span>
 <span class="keyword">sub</span><span class="variable"> colwidth</span><span class="operator">(</span>_<span class="operator">);</span>
 <span class="keyword">sub</span><span class="variable"> entitle</span><span class="operator">(</span>_<span class="operator">);</span>
 
 <span class="keyword">my</span> <span class="variable">%price</span> <span class="operator">=</span> <span class="operator">(</span>
     <span class="string">"Î³ÏÏÎ¿Ï"</span>             <span class="operator">=&gt;</span> <span class="number">6.50</span><span class="operator">,</span> <span class="comment"># gyros</span>
     <span class="string">"pears"</span>             <span class="operator">=&gt;</span> <span class="number">2.00</span><span class="operator">,</span> <span class="comment"># like um, pears</span>
     <span class="string">"linguiÃ§a"</span>          <span class="operator">=&gt;</span> <span class="number">7.00</span><span class="operator">,</span> <span class="comment"># spicy sausage, Portuguese</span>
     <span class="string">"xoriÃ§o"</span>            <span class="operator">=&gt;</span> <span class="number">3.00</span><span class="operator">,</span> <span class="comment"># chorizo sausage, Catalan</span>
     <span class="string">"hamburger"</span>         <span class="operator">=&gt;</span> <span class="number">6.00</span><span class="operator">,</span> <span class="comment"># burgermeister meisterburger</span>
     <span class="string">"Ã©clair"</span>            <span class="operator">=&gt;</span> <span class="number">1.60</span><span class="operator">,</span> <span class="comment"># dessert, French</span>
     <span class="string">"smÃ¸rbrÃ¸d"</span>          <span class="operator">=&gt;</span> <span class="number">5.75</span><span class="operator">,</span> <span class="comment"># sandwiches, Norwegian</span>
     <span class="string">"spÃ¤tzle"</span>           <span class="operator">=&gt;</span> <span class="number">5.50</span><span class="operator">,</span> <span class="comment"># Bayerisch noodles, little sparrows</span>
     <span class="string">"åå­"</span>              <span class="operator">=&gt;</span> <span class="number">7.50</span><span class="operator">,</span> <span class="comment"># bao1 zi5, steamed pork buns, Mandarin</span>
     <span class="string">"jamÃ³n serrano"</span>     <span class="operator">=&gt;</span> <span class="number">4.45</span><span class="operator">,</span> <span class="comment"># country ham, Spanish</span>
     <span class="string">"pÃªches"</span>            <span class="operator">=&gt;</span> <span class="number">2.25</span><span class="operator">,</span> <span class="comment"># peaches, French</span>
     <span class="string">"ã·ã¥ã¼ã¯ãªã¼ã "</span>    <span class="operator">=&gt;</span> <span class="number">1.85</span><span class="operator">,</span> <span class="comment"># cream-filled pastry like eclair</span>
     <span class="string">"ë§ê±¸ë¦¬"</span>            <span class="operator">=&gt;</span> <span class="number">4.00</span><span class="operator">,</span> <span class="comment"># makgeolli, Korean rice wine</span>
     <span class="string">"å¯¿å¸"</span>              <span class="operator">=&gt;</span> <span class="number">9.99</span><span class="operator">,</span> <span class="comment"># sushi, Japanese</span>
     <span class="string">"ããã¡"</span>            <span class="operator">=&gt;</span> <span class="number">2.65</span><span class="operator">,</span> <span class="comment"># omochi, rice cakes, Japanese</span>
     <span class="string">"crÃ¨me brÃ»lÃ©e"</span>      <span class="operator">=&gt;</span> <span class="number">2.00</span><span class="operator">,</span> <span class="comment"># crema catalana</span>
     <span class="string">"fideuÃ "</span>            <span class="operator">=&gt;</span> <span class="number">4.20</span><span class="operator">,</span> <span class="comment"># more noodles, Valencian</span>
                                  <span class="comment"># (Catalan=fideuada)</span>
     <span class="string">"pÃ¢tÃ©"</span>              <span class="operator">=&gt;</span> <span class="number">4.15</span><span class="operator">,</span> <span class="comment"># gooseliver paste, French</span>
     <span class="string">"ãå¥½ã¿ç¼ã"</span>        <span class="operator">=&gt;</span> <span class="number">8.00</span><span class="operator">,</span> <span class="comment"># okonomiyaki, Japanese</span>
 <span class="operator">);</span>
 
 <span class="keyword">my</span> <span class="variable">$width</span> <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="variable">max</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="variable">colwidth</span> <span class="operator">}</span> <span class="keyword">keys</span> <span class="variable">%price</span><span class="operator">;</span>
 
 <span class="comment"># So the Asian stuff comes out in an order that someone</span>
 <span class="comment"># who reads those scripts won't freak out over; the</span>
 <span class="comment"># CJK stuff will be in JIS X 0208 order that way.</span>
 <span class="keyword">my</span> <span class="variable">$coll</span>  <span class="operator">=</span> <span class="variable">Unicode::Collate::Locale</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">locale</span> <span class="operator">=&gt;</span> <span class="string">"ja"</span><span class="operator">);</span>
 
 <span class="keyword">for</span> <span class="keyword">my</span> <span class="variable">$item</span> <span class="operator">(</span><span class="variable">$coll</span><span class="operator">-&gt;</span><span class="variable">sort</span><span class="operator">(</span><span class="keyword">keys</span> <span class="variable">%price</span><span class="operator">))</span> <span class="operator">{</span>
     <span class="keyword">print</span> <span class="variable">pad</span><span class="operator">(</span><span class="variable">entitle</span><span class="operator">(</span><span class="variable">$item</span><span class="operator">),</span> <span class="variable">$width</span><span class="operator">,</span> <span class="string">"."</span><span class="operator">);</span>
     <span class="keyword">printf</span> <span class="string">" â¬%.2f\n"</span><span class="operator">,</span> <span class="variable">$price</span><span class="operator">{</span><span class="variable">$item</span><span class="operator">}</span><span class="operator">;</span>
 <span class="operator">}</span>
 
 <span class="keyword">sub</span><span class="variable"> pad</span><span class="operator">(</span>$$$<span class="operator">)</span> <span class="operator">{</span>
     <span class="keyword">my</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">,</span> <span class="variable">$width</span><span class="operator">,</span> <span class="variable">$padchar</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
     <span class="keyword">return</span> <span class="variable">$str</span> <span class="operator">.</span> <span class="operator">(</span><span class="variable">$padchar</span> <span class="operator">x</span> <span class="operator">(</span><span class="variable">$width</span> <span class="operator">-</span> <span class="variable">colwidth</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">)));</span>
 <span class="operator">}</span>
 
 <span class="keyword">sub</span><span class="variable"> colwidth</span><span class="operator">(</span>_<span class="operator">)</span> <span class="operator">{</span>
     <span class="keyword">my</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
     <span class="keyword">return</span> <span class="variable">Unicode::GCString</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">)-&gt;</span><span class="variable">columns</span><span class="operator">;</span>
 <span class="operator">}</span>
 
 <span class="keyword">sub</span><span class="variable"> entitle</span><span class="operator">(</span>_<span class="operator">)</span> <span class="operator">{</span>
     <span class="keyword">my</span><span class="operator">(</span><span class="variable">$str</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
     <span class="variable">$str</span> <span class="operator">=~</span> <span class="regex">s{ (?=\pL)(\S)     (\S*) }
              { ucfirst($1) . lc($2)  }xge</span><span class="operator">;</span>
     <span class="keyword">return</span> <span class="variable">$str</span><span class="operator">;</span>
 <span class="operator">}</span>
</code></pre>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<p>See these manpages, some of which are CPAN modules: <a href="../../lib/pods/perlunicode.html">perlunicode</a>, <a href="../../lib/pods/perluniprops.html">perluniprops</a>, <a href="../../lib/pods/perlre.html">perlre</a>, <a href="../../lib/pods/perlrecharclass.html">perlrecharclass</a>, <a href="../../lib/pods/perluniintro.html">perluniintro</a>, <a href="../../lib/pods/perlunitut.html">perlunitut</a>, <a href="../../lib/pods/perlunifaq.html">perlunifaq</a>, <a href="../../lib/PerlIO.html">PerlIO</a>, <a>DB_File</a>, <a href="../../lib/DBM_Filter.html">DBM_Filter</a>, <a href="../../lib/DBM_Filter/utf8.html">DBM_Filter::utf8</a>, <a href="../../lib/Encode.html">Encode</a>, <a href="../../lib/Encode/Locale.html">Encode::Locale</a>, <a href="../../lib/Unicode/UCD.html">Unicode::UCD</a>, <a href="../../lib/Unicode/Normalize.html">Unicode::Normalize</a>, <a>Unicode::GCString</a>, <a>Unicode::LineBreak</a>, <a href="../../lib/Unicode/Collate.html">Unicode::Collate</a>, <a href="../../lib/Unicode/Collate/Locale.html">Unicode::Collate::Locale</a>, <a>Unicode::Unihan</a>, <a>Unicode::CaseFold</a>, <a>Unicode::Tussle</a>, <a>Lingua::JA::Romanize::Japanese</a>, <a>Lingua::ZH::Romanize::Pinyin</a>, <a>Lingua::KO::Romanize::Hangul</a>.</p>

<p>The <a>Unicode::Tussle</a> CPAN module includes many programs to help with working with Unicode, including these programs to fully or partly replace standard utilities: <i>tcgrep</i> instead of <i>egrep</i>, <i>uniquote</i> instead of <i>cat -v</i> or <i>hexdump</i>, <i>uniwc</i> instead of <i>wc</i>, <i>unilook</i> instead of <i>look</i>, <i>unifmt</i> instead of <i>fmt</i>, and <i>ucsort</i> instead of <i>sort</i>. For exploring Unicode character names and character properties, see its <i>uniprops</i>, <i>unichars</i>, and <i>uninames</i> programs. It also supplies these programs, all of which are general filters that do Unicode-y things: <i>unititle</i> and <i>unicaps</i>; <i>uniwide</i> and <i>uninarrow</i>; <i>unisupers</i> and <i>unisubs</i>; <i>nfd</i>, <i>nfc</i>, <i>nfkd</i>, and <i>nfkc</i>; and <i>uc</i>, <i>lc</i>, and <i>tc</i>.</p>

<p>Finally, see the published Unicode Standard (page numbers are from version 6.0.0), including these specific annexes and technical reports:</p>

<dl>

<dt id="Default-Case-Algorithms-page-113-4.2-Case-pages-120122-Case-Mappings-page-166172-especially-Caseless-Matching-starting-on-page-170">&sect;3.13 Default Case Algorithms, page 113; &sect;4.2 Case, pages 120&ndash;122; Case Mappings, page 166&ndash;172, especially Caseless Matching starting on page 170.</dt>
<dd>

</dd>
<dt id="UAX-44:-Unicode-Character-Database">UAX #44: Unicode Character Database</dt>
<dd>

</dd>
<dt id="UTS-18:-Unicode-Regular-Expressions">UTS #18: Unicode Regular Expressions</dt>
<dd>

</dd>
<dt id="UAX-15:-Unicode-Normalization-Forms">UAX #15: Unicode Normalization Forms</dt>
<dd>

</dd>
<dt id="UTS-10:-Unicode-Collation-Algorithm">UTS #10: Unicode Collation Algorithm</dt>
<dd>

</dd>
<dt id="UAX-29:-Unicode-Text-Segmentation">UAX #29: Unicode Text Segmentation</dt>
<dd>

</dd>
<dt id="UAX-14:-Unicode-Line-Breaking-Algorithm">UAX #14: Unicode Line Breaking Algorithm</dt>
<dd>

</dd>
<dt id="UAX-11:-East-Asian-Width">UAX #11: East Asian Width</dt>
<dd>

</dd>
</dl>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Tom Christiansen &lt;tchrist@perl.com&gt; wrote this, with occasional kibbitzing from Larry Wall and Jeffrey Friedl in the background.</p>

<h1 id="COPYRIGHT-AND-LICENCE">COPYRIGHT AND LICENCE</h1>

<p>Copyright &copy; 2012 Tom Christiansen.</p>

<p>This program is free software; you may redistribute it and/or modify it under the same terms as Perl itself.</p>

<p>Most of these examples taken from the current edition of the &ldquo;Camel Book&rdquo;; that is, from the 4&#x1D57;&#x2B0; Edition of <i>Programming Perl</i>, Copyright &copy; 2012 Tom Christiansen &lt;et al.&gt;, 2012-02-13 by O&rsquo;Reilly Media. The code itself is freely redistributable, and you are encouraged to transplant, fold, spindle, and mutilate any of the examples in this manpage however you please for inclusion into your own programs without any encumbrance whatsoever. Acknowledgement via code comment is polite but not required.</p>

<h1 id="REVISION-HISTORY">REVISION HISTORY</h1>

<p>v1.0.0 &ndash; first public release, 2012-02-27</p>


</body>

</html>


