<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../displayToc.js"></script>
<script language="JavaScript" src="../../../tocParas.js"></script>
<script language="JavaScript" src="../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../scineplex.css">
<title></title>
<link rel="stylesheet" href="../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#API">API</a>
    <ul>
      <li><a href="#Specio::Constraint::Simple-new">Specio::Constraint::Simple-&gt;new(...)</a></li>
      <li><a href="#type-name">$type-&gt;name</a></li>
      <li><a href="#type-parent">$type-&gt;parent</a></li>
      <li><a href="#type-is_anon">$type-&gt;is_anon</a></li>
      <li><a href="#type-is_a_type_of-other_type">$type-&gt;is_a_type_of($other_type)</a></li>
      <li><a href="#type-is_same_type_as-other_type">$type-&gt;is_same_type_as($other_type)</a></li>
      <li><a href="#type-coercions">$type-&gt;coercions</a></li>
      <li><a href="#type-coercion_from_type-name">$type-&gt;coercion_from_type($name)</a></li>
      <li><a href="#type-validate_or_die-value">$type-&gt;validate_or_die($value)</a></li>
      <li><a href="#type-value_is_valid-value">$type-&gt;value_is_valid($value)</a></li>
      <li><a href="#type-has_real_constraint">$type-&gt;has_real_constraint</a></li>
      <li><a href="#type-description">$type-&gt;description</a></li>
      <li><a href="#type-id">$type-&gt;id</a></li>
      <li><a href="#type-add_coercion-coercion">$type-&gt;add_coercion($coercion)</a></li>
      <li><a href="#type-has_coercion_from_type-other_type">$type-&gt;has_coercion_from_type($other_type)</a></li>
      <li><a href="#type-coerce_value-value">$type-&gt;coerce_value($value)</a></li>
      <li><a href="#type-inline_coercion_and_check-var">$type-&gt;inline_coercion_and_check($var)</a></li>
      <li><a href="#type-inline_assert-var">$type-&gt;inline_assert($var)</a></li>
      <li><a href="#type-inline_check-var">$type-&gt;inline_check($var)</a></li>
      <li><a href="#type-inline_coercion-var">$type-&gt;inline_coercion($var)</a></li>
      <li><a href="#type-inline_environment">$type-&gt;inline_environment()</a></li>
      <li><a href="#type-coercion_sub">$type-&gt;coercion_sub</a></li>
    </ul>
  </li>
  <li><a href="#OVERLOADING">OVERLOADING</a></li>
  <li><a href="#ROLES">ROLES</a></li>
  <li><a href="#SUPPORT">SUPPORT</a></li>
  <li><a href="#SOURCE">SOURCE</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Specio::Constraint::Simple - Class for simple (non-parameterized or specialized) types</p>

<h1 id="VERSION">VERSION</h1>

<p>version 0.42</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>    <span class="keyword">my</span> <span class="variable">$str</span> <span class="operator">=</span> <span class="variable">t</span><span class="operator">(</span><span class="string">'Str'</span><span class="operator">);</span>
    
    <span class="keyword">print</span> <span class="variable">$str</span><span class="operator">-&gt;</span><span class="variable">name</span><span class="operator">;</span> <span class="comment"># Str</span>
    
    <span class="keyword">my</span> <span class="variable">$parent</span> <span class="operator">=</span> <span class="variable">$str</span><span class="operator">-&gt;</span><span class="variable">parent</span><span class="operator">;</span>
    
    <span class="keyword">if</span> <span class="operator">(</span> <span class="variable">$str</span><span class="operator">-&gt;</span><span class="variable">value_is_valid</span><span class="operator">(</span><span class="variable">$value</span><span class="operator">)</span> <span class="operator">)</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
    
    <span class="variable">$str</span><span class="operator">-&gt;</span><span class="variable">validate_or_die</span><span class="operator">(</span><span class="variable">$value</span><span class="operator">);</span>
    
    <span class="keyword">my</span> <span class="variable">$code</span> <span class="operator">=</span> <span class="variable">$str</span><span class="operator">-&gt;</span><span class="variable">inline_coercion_and_check</span><span class="operator">(</span><span class="string">'$_[0]'</span><span class="operator">);</span>
</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This class implements simple type constraints, constraints without special properties or parameterization.</p>

<p>It does not actually contain any real code of its own. The entire implementation is provided by the <a href="../../../lib/Specio/Constraint/Role/Interface.html">Specio::Constraint::Role::Interface</a> role, but the primary API for type constraints is documented here.</p>

<p>All other type constraint classes in this distribution implement this API, except where otherwise noted.</p>

<h1 id="API">API</h1>

<p>This class provides the following methods.</p>

<h2 id="Specio::Constraint::Simple-new">Specio::Constraint::Simple-&gt;new(...)</h2>

<p>This creates a new constraint. It accepts the following named parameters:</p>

<ul>

<li><p>name =&gt; $name</p>

<p>This is the type&#39;s name. The name is optional, but if provided it must be a string.</p>

</li>
<li><p>parent =&gt; $type</p>

<p>The type&#39;s parent type. This must be an object which does the <a href="../../../lib/Specio/Constraint/Role/Interface.html">Specio::Constraint::Role::Interface</a> role.</p>

<p>This parameter is optional.</p>

</li>
<li><p>constraint =&gt; sub { ... }</p>

<p>A subroutine reference implementing the constraint. It will be called as a method on the object and passed a single argument, the value to check.</p>

<p>It should return true or false to indicate whether the value matches the constraint.</p>

<p>This parameter is mutually exclusive with <code>inline_generator</code>.</p>

<p>You can also pass this option with the key <code>where</code> in the parameter list.</p>

</li>
<li><p>inline_generator =&gt; sub { ... }</p>

<p>This should be a subroutine reference which returns a string containing a single term. This code should <i>not</i> end in a semicolon. This code should implement the constraint.</p>

<p>The generator will be called as a method on the constraint with a single argument. That argument is the name of the variable being coerced, something like <code>&#39;$_[0]&#39;</code> or <code>&#39;$var&#39;</code>.</p>

<p>The inline generator is expected to include code to implement both the current type and all its parents. Typically, the easiest way to do this is to write a subroutine something like this:</p>

<pre><code>  <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
      <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
      <span class="keyword">my</span> <span class="variable">$var</span>  <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
  
      <span class="keyword">return</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">-&gt;</span><span class="variable">parent</span><span class="operator">-&gt;</span><span class="variable">inline_check</span><span class="operator">(</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span> <span class="operator">)</span>
          <span class="operator">.</span> <span class="string">' and more checking code goes here'</span><span class="operator">;</span>
  <span class="operator">}</span>
</code></pre>

<p>This parameter is mutually exclusive with <code>constraint</code>.</p>

<p>You can also pass this option with the key <code>inline</code> in the parameter list.</p>

</li>
<li><p>inline_environment =&gt; {}</p>

<p>This should be a hash reference of variable names (with sigils) and values for that variable. The values should be <i>references</i> to the values of the variables.</p>

<p>This environment will be used when compiling the constraint as part of a subroutine. The named variables will be captured as closures in the generated subroutine, using <a href="../../../lib/Eval/Closure.html">Eval::Closure</a>.</p>

<p>It should be very rare to need to set this in the constructor. It&#39;s more likely that a special type subclass would need to provide values that it generates internally.</p>

<p>If you do set this, you are responsible for generating variable names that won&#39;t clash with anything else in the inlined code.</p>

<p>This parameter defaults to an empty hash reference.</p>

</li>
<li><p>message_generator =&gt; sub { ... }</p>

<p>A subroutine to generate an error message when the type check fails. The default message says something like &quot;Validation failed for type named Int declared in package Specio::Library::Builtins (.../Specio/blib/lib/Specio/Library/Builtins.pm) at line 147 in sub named (eval) with value 1.1&quot;.</p>

<p>You can override this to provide something more specific about the way the type failed.</p>

<p>The subroutine you provide will be called as a subroutine, <i>not as a method</i>, with two arguments. The first is the description of the type (the bit in the message above that starts with &quot;type named Int ...&quot; and ends with &quot;... in sub named (eval)&quot;. This description says what the thing is and where it was defined.</p>

<p>The second argument is the value that failed the type check, after any coercions that might have been applied.</p>

<p>You can also pass this option with the key <code>message</code> in the parameter list.</p>

</li>
<li><p>declared_at =&gt; $declared_at</p>

<p>This parameter must be a <a href="../../../lib/Specio/DeclaredAt.html">Specio::DeclaredAt</a> object.</p>

<p>This parameter is required.</p>

</li>
</ul>

<p>It is possible to create a type without a constraint of its own.</p>

<h2 id="type-name">$type-&gt;name</h2>

<p>Returns the name of the type as it was passed the constructor.</p>

<h2 id="type-parent">$type-&gt;parent</h2>

<p>Returns the parent type passed to the constructor. If the type has no parent this returns <code>undef</code>.</p>

<h2 id="type-is_anon">$type-&gt;is_anon</h2>

<p>Returns false for named types, true otherwise.</p>

<h2 id="type-is_a_type_of-other_type">$type-&gt;is_a_type_of($other_type)</h2>

<p>Given a type object, this returns true if the type this method is called on is a descendant of that type or is that type.</p>

<h2 id="type-is_same_type_as-other_type">$type-&gt;is_same_type_as($other_type)</h2>

<p>Given a type object, this returns true if the type this method is called on is the same as that type.</p>

<h2 id="type-coercions">$type-&gt;coercions</h2>

<p>Returns a list of <a href="../../../lib/Specio/Coercion.html">Specio::Coercion</a> objects which belong to this constraint.</p>

<h2 id="type-coercion_from_type-name">$type-&gt;coercion_from_type($name)</h2>

<p>Given a type name, this method returns a <a href="../../../lib/Specio/Coercion.html">Specio::Coercion</a> object which coerces from that type, if such a coercion exists.</p>

<h2 id="type-validate_or_die-value">$type-&gt;validate_or_die($value)</h2>

<p>This method does nothing if the value is valid. If it is not, it throws a <a href="../../../lib/Specio/Exception.html">Specio::Exception</a>.</p>

<h2 id="type-value_is_valid-value">$type-&gt;value_is_valid($value)</h2>

<p>Returns true or false depending on whether the <code>$value</code> passes the type constraint.</p>

<h2 id="type-has_real_constraint">$type-&gt;has_real_constraint</h2>

<p>This returns true if the type was created with a <code>constraint</code> or <code>inline_generator</code> parameter. This is used internally to skip type checks for types that don&#39;t actually implement a constraint.</p>

<h2 id="type-description">$type-&gt;description</h2>

<p>This returns a string describing the type. This includes the type&#39;s name and where it was declared, so you end up with something like <code>&#39;type named Foo declared in package My::Lib (lib/My/Lib.pm) at line 42&#39;</code>. If the type is anonymous the name will be &quot;anonymous type&quot;.</p>

<h2 id="type-id">$type-&gt;id</h2>

<p>This is a unique id for the type as a string. This is useful if you need to make a hash key based on a type, for example. This should be treated as an essentially arbitrary and opaque string, and could change at any time in the future. If you want something human-readable, use the <code>$type-&gt;description</code> method.</p>

<h2 id="type-add_coercion-coercion">$type-&gt;add_coercion($coercion)</h2>

<p>This adds a new <a href="../../../lib/Specio/Coercion.html">Specio::Coercion</a> to the type. If the type already has a coercion from the same type as the new coercion, it will throw an error.</p>

<h2 id="type-has_coercion_from_type-other_type">$type-&gt;has_coercion_from_type($other_type)</h2>

<p>This method returns true if the type can coerce from the other type.</p>

<h2 id="type-coerce_value-value">$type-&gt;coerce_value($value)</h2>

<p>This attempts to coerce a value into a new value that matches the type. It checks all of the type&#39;s coercions. If it finds one which has a &quot;from&quot; type that accepts the value, it runs the coercion and returns the new value.</p>

<p>If it cannot find a matching coercion it returns the original value.</p>

<h2 id="type-inline_coercion_and_check-var">$type-&gt;inline_coercion_and_check($var)</h2>

<p>Given a variable name, this returns a string of code and an environment hash that implements all of the type&#39;s coercions as well as the type check itself.</p>

<p>This will throw an exception unless both the type and all of its coercions are inlinable.</p>

<p>The generated code will throw a <a href="../../../lib/Specio/Exception.html">Specio::Exception</a> if the type constraint fails. If the constraint passes, then the generated code returns the (possibly coerced) value.</p>

<p>The return value is a two-element list. The first element is the code. The second is a hash reference containing variables which need to be in scope for the code to work. This is intended to be passed to <a href="../../../lib/Eval/Closure.html">Eval::Closure</a>&#39;s <code>eval_closure</code> subroutine.</p>

<p>The returned code is a single <code><span class="keyword">do</span> <span class="operator">{</span> <span class="operator">}</span>
</code> block without a terminating semicolon.</p>

<h2 id="type-inline_assert-var">$type-&gt;inline_assert($var)</h2>

<p>Given a variable name, this generates code that implements the constraint and throws an exception if the variable does not pass the constraint.</p>

<p>The return value is a two-element list. The first element is the code. The second is a hash reference containing variables which need to be in scope for the code to work. This is intended to be passed to <a href="../../../lib/Eval/Closure.html">Eval::Closure</a>&#39;s <code>eval_closure</code> subroutine.</p>

<h2 id="type-inline_check-var">$type-&gt;inline_check($var)</h2>

<p>Given a variable name, this returns a string of code that implements the constraint. If the type is not inlinable, this method throws an error.</p>

<h2 id="type-inline_coercion-var">$type-&gt;inline_coercion($var)</h2>

<p>Given a variable name, this returns a string of code and an environment hash that implements all of the type&#39;s coercions. <i>It does not check that the resulting value is valid.</i></p>

<p>This will throw an exception unless all of the type&#39;s coercions are inlinable.</p>

<p>The return value is a two-element list. The first element is the code. The second is a hash reference containing variables which need to be in scope for the code to work. This is intended to be passed to <a href="../../../lib/Eval/Closure.html">Eval::Closure</a>&#39;s <code>eval_closure</code> subroutine.</p>

<p>The returned code is a single <code><span class="keyword">do</span> <span class="operator">{</span> <span class="operator">}</span>
</code> block without a terminating semicolon.</p>

<h2 id="type-inline_environment">$type-&gt;inline_environment()</h2>

<p>This returns a hash defining the variables that need to be closed over when inlining the type. The keys are full variable names like <code>&#39;$foo&#39;</code> or <code>&#39;@bar&#39;</code>. The values are <i>references</i> to a variable of the matching type.</p>

<h2 id="type-coercion_sub">$type-&gt;coercion_sub</h2>

<p>This method returns a sub ref that takes a single argument and applied all relevant coercions to it. This sub ref will use <a href="../../../lib/Sub/Quote.html">Sub::Quote</a> if all the type&#39;s coercions are inlinable.</p>

<p>This method exists primarily for the benefit of <a>Moo</a>.</p>

<h1 id="OVERLOADING">OVERLOADING</h1>

<p>All constraints overloading subroutine de-referencing for the benefit of <a>Moo</a>. The returned subroutine uses <a href="../../../lib/Sub/Quote.html">Sub::Quote</a> if the type constraint is inlinable.</p>

<h1 id="ROLES">ROLES</h1>

<p>This role does the <a href="../../../lib/Specio/Constraint/Role/Interface.html">Specio::Constraint::Role::Interface</a> and <a href="../../../lib/Specio/Role/Inlinable.html">Specio::Role::Inlinable</a> roles.</p>

<h1 id="SUPPORT">SUPPORT</h1>

<p>Bugs may be submitted at <a href="https://github.com/houseabsolute/Specio/issues">https://github.com/houseabsolute/Specio/issues</a>.</p>

<p>I am also usually active on IRC as &#39;autarch&#39; on <code>irc://irc.perl.org</code>.</p>

<h1 id="SOURCE">SOURCE</h1>

<p>The source code repository for Specio can be found at <a href="https://github.com/houseabsolute/Specio">https://github.com/houseabsolute/Specio</a>.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Dave Rolsky &lt;autarch@urth.org&gt;</p>

<h1 id="COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</h1>

<p>This software is Copyright (c) 2012 - 2017 by Dave Rolsky.</p>

<p>This is free software, licensed under:</p>

<pre><code>  The Artistic License 2.0 (GPL Compatible)</code></pre>

<p>The full text of the license can be found in the <i>LICENSE</i> file included with this distribution.</p>


</body>

</html>


