<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../displayToc.js"></script>
<script language="JavaScript" src="../../tocParas.js"></script>
<script language="JavaScript" src="../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../scineplex.css">
<title></title>
<link rel="stylesheet" href="../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a>
    <ul>
      <li><a href="#Keeping-packages-clean">Keeping packages clean</a>
        <ul>
          <li><a href="#Late-binding-caveat">Late binding caveat</a></li>
        </ul>
      </li>
      <li><a href="#Explicitly-removing-functions-when-your-scope-is-compiled">Explicitly removing functions when your scope is compiled</a></li>
      <li><a href="#Moose">Moose</a></li>
      <li><a href="#Cleaning-other-packages">Cleaning other packages</a></li>
    </ul>
  </li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#clean_subroutines">clean_subroutines</a></li>
      <li><a href="#import">import</a></li>
      <li><a href="#unimport">unimport</a></li>
      <li><a href="#get_class_store">get_class_store</a></li>
      <li><a href="#get_functions">get_functions</a></li>
    </ul>
  </li>
  <li><a href="#IMPLEMENTATION-DETAILS">IMPLEMENTATION DETAILS</a></li>
  <li><a href="#SEE-ALSO">SEE ALSO</a></li>
  <li><a href="#THANKS">THANKS</a></li>
  <li><a href="#AUTHORS">AUTHORS</a></li>
  <li><a href="#COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>namespace::clean - Keep imports and functions out of your namespace</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>  <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">warnings</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
  
  <span class="keyword">use</span> <span class="variable">Carp</span> <span class="string">qw(croak)</span><span class="operator">;</span>   <span class="comment"># 'croak' will be removed</span>
  
  <span class="keyword">sub</span><span class="variable"> bar </span><span class="operator">{</span> <span class="number">23</span> <span class="operator">}</span>        <span class="comment"># 'bar' will be removed</span>
  
  <span class="comment"># remove all previously defined functions</span>
  <span class="keyword">use</span> <span class="variable">namespace::clean</span><span class="operator">;</span>
  
  <span class="keyword">sub</span><span class="variable"> baz </span><span class="operator">{</span> <span class="variable">bar</span><span class="operator">()</span> <span class="operator">}</span>     <span class="comment"># 'baz' still defined, 'bar' still bound</span>
  
  <span class="comment"># begin to collection function names from here again</span>
  <span class="keyword">no</span> <span class="variable">namespace::clean</span><span class="operator">;</span>
  
  <span class="keyword">sub</span><span class="variable"> quux </span><span class="operator">{</span> <span class="variable">baz</span><span class="operator">()</span> <span class="operator">}</span>    <span class="comment"># 'quux' will be removed</span>
  
  <span class="comment"># remove all functions defined after the 'no' unimport</span>
  <span class="keyword">use</span> <span class="variable">namespace::clean</span><span class="operator">;</span>
  
  <span class="comment"># Will print: 'No', 'No', 'Yes' and 'No'</span>
  <span class="keyword">print</span> <span class="operator">+(</span><span class="keyword">__PACKAGE__</span><span class="operator">-&gt;</span><span class="variable">can</span><span class="operator">(</span><span class="string">'croak'</span><span class="operator">)</span> <span class="operator">?</span> <span class="string">'Yes'</span> <span class="operator">:</span> <span class="string">'No'</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">;</span>
  <span class="keyword">print</span> <span class="operator">+(</span><span class="keyword">__PACKAGE__</span><span class="operator">-&gt;</span><span class="variable">can</span><span class="operator">(</span><span class="string">'bar'</span><span class="operator">)</span>   <span class="operator">?</span> <span class="string">'Yes'</span> <span class="operator">:</span> <span class="string">'No'</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">;</span>
  <span class="keyword">print</span> <span class="operator">+(</span><span class="keyword">__PACKAGE__</span><span class="operator">-&gt;</span><span class="variable">can</span><span class="operator">(</span><span class="string">'baz'</span><span class="operator">)</span>   <span class="operator">?</span> <span class="string">'Yes'</span> <span class="operator">:</span> <span class="string">'No'</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">;</span>
  <span class="keyword">print</span> <span class="operator">+(</span><span class="keyword">__PACKAGE__</span><span class="operator">-&gt;</span><span class="variable">can</span><span class="operator">(</span><span class="string">'quux'</span><span class="operator">)</span>  <span class="operator">?</span> <span class="string">'Yes'</span> <span class="operator">:</span> <span class="string">'No'</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">;</span>
  
  <span class="number">1</span><span class="operator">;</span>
</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<h2 id="Keeping-packages-clean">Keeping packages clean</h2>

<p>When you define a function, or import one, into a Perl package, it will naturally also be available as a method. This does not per se cause problems, but it can complicate subclassing and, for example, plugin classes that are included via multiple inheritance by loading them as base classes.</p>

<p>The <code>namespace::clean</code> pragma will remove all previously declared or imported symbols at the end of the current package&#39;s compile cycle. Functions called in the package itself will still be bound by their name, but they won&#39;t show up as methods on your class or instances.</p>

<p>By unimporting via <code>no</code> you can tell <code>namespace::clean</code> to start collecting functions for the next <code><span class="keyword">use</span> <span class="variable">namespace::clean</span><span class="operator">;</span>
</code> specification.</p>

<p>You can use the <code>-except</code> flag to tell <code>namespace::clean</code> that you don&#39;t want it to remove a certain function or method. A common use would be a module exporting an <code>import</code> method along with some functions:</p>

<pre><code>  <span class="keyword">use</span> <span class="variable">ModuleExportingImport</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">namespace::clean</span> <span class="operator">-</span><span class="string">except</span> <span class="operator">=&gt;</span> <span class="operator">[</span><span class="string">qw( import )</span><span class="operator">]</span><span class="operator">;</span>
</code></pre>

<p>If you just want to <code>-except</code> a single sub, you can pass it directly. For more than one value you have to use an array reference.</p>

<h3 id="Late-binding-caveat">Late binding caveat</h3>

<p>Note that the <a href="#IMPLEMENTATION-DETAILS">technique used by this module</a> relies on perl having resolved all names to actual code references during the compilation of a scope. While this is almost always what the interpreter does, there are some exceptions, notably the <a href="../../lib/pods/perlfunc.html#sort">sort SUBNAME</a> style of the <code>sort</code> built-in invocation. The following example will not work, because <code>sort</code> does not try to resolve the function name to an actual code reference until <b>runtime</b>.</p>

<pre><code> <span class="keyword">use</span> <span class="variable">MyApp::Utils</span> <span class="string">'my_sorter'</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">namespace::clean</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">@sorted</span> <span class="operator">=</span> <span class="keyword">sort</span> <span class="variable">my_sorter</span> <span class="variable">@list</span><span class="operator">;</span>
</code></pre>

<p>You need to work around this by forcing a compile-time resolution like so:</p>

<pre><code> <span class="keyword">use</span> <span class="variable">MyApp::Utils</span> <span class="string">'my_sorter'</span><span class="operator">;</span>
 <span class="keyword">use</span> <span class="variable">namespace::clean</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">$my_sorter_cref</span> <span class="operator">=</span> <span class="operator">\&amp;</span><span class="variable">my_sorter</span><span class="operator">;</span>
 
 <span class="keyword">my</span> <span class="variable">@sorted</span> <span class="operator">=</span> <span class="keyword">sort</span> <span class="variable">$my_sorter_cref</span> <span class="variable">@list</span><span class="operator">;</span>
</code></pre>

<h2 id="Explicitly-removing-functions-when-your-scope-is-compiled">Explicitly removing functions when your scope is compiled</h2>

<p>It is also possible to explicitly tell <code>namespace::clean</code> what packages to remove when the surrounding scope has finished compiling. Here is an example:</p>

<pre><code>  <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
  
  <span class="comment"># blessed NOT available</span>
  
  <span class="keyword">sub</span><span class="variable"> my_class </span><span class="operator">{</span>
      <span class="keyword">use</span> <span class="variable">Scalar::Util</span> <span class="string">qw( blessed )</span><span class="operator">;</span>
      <span class="keyword">use</span> <span class="variable">namespace::clean</span> <span class="string">qw( blessed )</span><span class="operator">;</span>
  
      <span class="comment"># blessed available</span>
      <span class="keyword">return</span> <span class="variable">blessed</span> <span class="keyword">shift</span><span class="operator">;</span>
  <span class="operator">}</span>
  
  <span class="comment"># blessed NOT available</span>
</code></pre>

<h2 id="Moose">Moose</h2>

<p>When using <code>namespace::clean</code> together with <a href="../../lib/Moose.html">Moose</a> you want to keep the installed <code>meta</code> method. So your classes should look like:</p>

<pre><code>  <span class="keyword">package</span> <span class="variable">Foo</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">Moose</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">namespace::clean</span> <span class="operator">-</span><span class="string">except</span> <span class="operator">=&gt;</span> <span class="string">'meta'</span><span class="operator">;</span>
  <span class="operator">...</span>
</code></pre>

<p>Same goes for <a href="../../lib/Moose/Role.html">Moose::Role</a>.</p>

<h2 id="Cleaning-other-packages">Cleaning other packages</h2>

<p>You can tell <code>namespace::clean</code> that you want to clean up another package instead of the one importing. To do this you have to pass in the <code>-cleanee</code> option like this:</p>

<pre><code>  <span class="keyword">package</span> <span class="variable">My::MooseX::namespace::clean</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
  
  <span class="keyword">use</span> <span class="variable">namespace::clean</span> <span class="operator">();</span> <span class="comment"># no cleanup, just load</span>
  
  <span class="keyword">sub</span><span class="variable"> import </span><span class="operator">{</span>
      <span class="variable">namespace::clean</span><span class="operator">-&gt;</span><span class="variable">import</span><span class="operator">(</span>
        <span class="string">-cleanee</span> <span class="operator">=&gt;</span> <span class="keyword">scalar</span><span class="operator">(</span><span class="keyword">caller</span><span class="operator">),</span>
        <span class="string">-except</span>  <span class="operator">=&gt;</span> <span class="string">'meta'</span><span class="operator">,</span>
      <span class="operator">);</span>
  <span class="operator">}</span>
</code></pre>

<p>If you don&#39;t care about <code>namespace::clean</code>s discover-and-<code>-except</code> logic, and just want to remove subroutines, try <a href="#clean_subroutines">&quot;clean_subroutines&quot;</a>.</p>

<h1 id="METHODS">METHODS</h1>

<h2 id="clean_subroutines">clean_subroutines</h2>

<p>This exposes the actual subroutine-removal logic.</p>

<pre><code>  <span class="variable">namespace::clean</span><span class="operator">-&gt;</span><span class="variable">clean_subroutines</span><span class="operator">(</span><span class="variable">$cleanee</span><span class="operator">,</span> <span class="string">qw( subA subB )</span><span class="operator">);</span>
</code></pre>

<p>will remove <code>subA</code> and <code>subB</code> from <code>$cleanee</code>. Note that this will remove the subroutines <b>immediately</b> and not wait for scope end. If you want to have this effect at a specific time (e.g. <code>namespace::clean</code> acts on scope compile end) it is your responsibility to make sure it runs at that time.</p>

<h2 id="import">import</h2>

<p>Makes a snapshot of the current defined functions and installs a <a href="../../lib/B/Hooks/EndOfScope.html">B::Hooks::EndOfScope</a> hook in the current scope to invoke the cleanups.</p>

<h2 id="unimport">unimport</h2>

<p>This method will be called when you do a</p>

<pre><code>  <span class="keyword">no</span> <span class="variable">namespace::clean</span><span class="operator">;</span>
</code></pre>

<p>It will start a new section of code that defines functions to clean up.</p>

<h2 id="get_class_store">get_class_store</h2>

<p>This returns a reference to a hash in a passed package containing information about function names included and excluded from removal.</p>

<h2 id="get_functions">get_functions</h2>

<p>Takes a class as argument and returns all currently defined functions in it as a hash reference with the function name as key and a typeglob reference to the symbol as value.</p>

<h1 id="IMPLEMENTATION-DETAILS">IMPLEMENTATION DETAILS</h1>

<p>This module works through the effect that a</p>

<pre><code>  <span class="keyword">delete</span> <span class="variable">$SomePackage::</span><span class="operator">{</span><span class="string">foo</span><span class="operator">}</span><span class="operator">;</span>
</code></pre>

<p>will remove the <code>foo</code> symbol from <code>$SomePackage</code> for run time lookups (e.g., method calls) but will leave the entry alive to be called by already resolved names in the package itself. <code>namespace::clean</code> will restore and therefor in effect keep all glob slots that aren&#39;t <code>CODE</code>.</p>

<p>A test file has been added to the perl core to ensure that this behaviour will be stable in future releases.</p>

<p>Just for completeness sake, if you want to remove the symbol completely, use <code>undef</code> instead.</p>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<p><a href="../../lib/B/Hooks/EndOfScope.html">B::Hooks::EndOfScope</a></p>

<h1 id="THANKS">THANKS</h1>

<p>Many thanks to Matt S Trout for the inspiration on the whole idea.</p>

<h1 id="AUTHORS">AUTHORS</h1>

<ul>

<li><p>Robert &#39;phaylon&#39; Sedlacek &lt;rs@474.at&gt;</p>

</li>
<li><p>Florian Ragwitz &lt;rafl@debian.org&gt;</p>

</li>
<li><p>Jesse Luehrs &lt;doy@tozt.net&gt;</p>

</li>
<li><p>Peter Rabbitson &lt;ribasushi@cpan.org&gt;</p>

</li>
<li><p>Father Chrysostomos &lt;sprout@cpan.org&gt;</p>

</li>
</ul>

<h1 id="COPYRIGHT-AND-LICENSE">COPYRIGHT AND LICENSE</h1>

<p>This software is copyright (c) 2011 by <a href="#AUTHORS">&quot;AUTHORS&quot;</a></p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>


</body>

</html>


