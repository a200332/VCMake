<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../../displayToc.js"></script>
<script language="JavaScript" src="../../../../tocParas.js"></script>
<script language="JavaScript" src="../../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../scineplex.css">
<title></title>
<link rel="stylesheet" href="../../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#COMPLETE-CODE-UP-FRONT">COMPLETE CODE UP FRONT</a></li>
  <li><a href="#LINE-BY-LINE">LINE BY LINE</a></li>
  <li><a href="#CONTEXT-OBJECT-DOCUMENTATION">CONTEXT OBJECT DOCUMENTATION</a></li>
  <li><a href="#SEE-ALSO">SEE ALSO</a></li>
  <li><a href="#SOURCE">SOURCE</a></li>
  <li><a href="#MAINTAINERS">MAINTAINERS</a></li>
  <li><a href="#AUTHORS">AUTHORS</a></li>
  <li><a href="#COPYRIGHT">COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Test2::Manual::Tooling::FirstTool - Write your first tool with Test2.</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This tutorial will help you write your very first tool by cloning the <code>ok()</code> tool.</p>

<h1 id="COMPLETE-CODE-UP-FRONT">COMPLETE CODE UP FRONT</h1>

<pre><code>    <span class="keyword">package</span> <span class="variable">Test2::Tools::MyOk</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">warnings</span><span class="operator">;</span>
    
    <span class="keyword">use</span> <span class="variable">Test2::API</span> <span class="string">qw/context/</span><span class="operator">;</span>
    
    <span class="keyword">use</span> <span class="variable">base</span> <span class="string">'Exporter'</span><span class="operator">;</span>
    <span class="keyword">our</span> <span class="variable">@EXPORT</span> <span class="operator">=</span> <span class="string">qw/ok/</span><span class="operator">;</span>
    
    <span class="keyword">sub</span><span class="variable"> ok</span><span class="operator">(</span>$;$@<span class="operator">)</span> <span class="operator">{</span>
        <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$bool</span><span class="operator">,</span> <span class="variable">$name</span><span class="operator">,</span> <span class="variable">@diag</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    
        <span class="keyword">my</span> <span class="variable">$ctx</span> <span class="operator">=</span> <span class="variable">context</span><span class="operator">();</span>
    
        <span class="keyword">return</span> <span class="variable">$ctx</span><span class="operator">-&gt;</span><span class="variable">pass_and_release</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">)</span> <span class="keyword">if</span> <span class="variable">$bool</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="variable">$ctx</span><span class="operator">-&gt;</span><span class="variable">fail_and_release</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">,</span> <span class="variable">@diag</span><span class="operator">);</span>
    <span class="operator">}</span>
    
    <span class="number">1</span><span class="operator">;</span>
</code></pre>

<h1 id="LINE-BY-LINE">LINE BY LINE</h1>

<dl>

<dt id="sub-ok">sub ok($;$@) {</dt>
<dd>

<p>In this case we are emulating the <code>ok()</code> function exported by <a href="../../../../lib/Test2/Tools/Basic.html">Test2::Tools::Basic</a>.</p>

<p><code>ok()</code> and similar test tools use prototypes to enforce argument parsing. Your test tools do not necessarily need prototypes, like any perl function you need to make the decision based on how it is used.</p>

<p>The prototype requires at least 1 argument, which will be forced into a scalar context. The second argument is optional, and is also forced to be scalar, it is the name of the test. Any remaining arguments are treated as diagnostics messages that will only be used if the test failed.</p>

</dd>
<dt id="my-bool-name-diag-_">my ($bool, $name, @diag) = @_;</dt>
<dd>

<p>This line does not need much explanation, we are simply grabbing the args.</p>

</dd>
<dt id="my-ctx-context">my $ctx = context();</dt>
<dd>

<p>This is a vital line in <b>ALL</b> tools. The context object is the primary API for test tools. You <b>MUST</b> get a context if you want to issue any events, such as making assertions. Further, the context is responsible for making sure failures are attributed to the correct file and line number.</p>

<p><b>Note:</b> A test function <b>MUST</b> always release the context when it is done, you cannot simply let it fall out of scope and be garbage collected. Test2 does a pretty good job of yelling at you if you make this mistake.</p>

<p><b>Note:</b> You <b>MUST NOT</b> ever store or pass around a <i>real</i> context object. If you wish to hold on to a context for any reason you must use clone to make a copy <code>my $copy = $ctx-&gt;clone</code>. The copy may be passed around or stored, but the original <b>MUST</b> be released when you are done with it.</p>

</dd>
<dt id="return-ctx-pass_and_release-name-if-bool">return $ctx-&gt;pass_and_release($name) if $bool;</dt>
<dd>

<p>When <code>$bool</code> is true, this line uses the context object to issue a <a href="../../../../lib/Test2/Event/Pass.html">Test2::Event::Pass</a> event. Along with issuing the event this will also release the context object and return true.</p>

<p>This is short form for:</p>

<pre><code>    <span class="keyword">if</span><span class="operator">(</span><span class="variable">$bool</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="variable">$ctx</span><span class="operator">-&gt;</span><span class="variable">pass</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">);</span>
        <span class="variable">$ctx</span><span class="operator">-&gt;</span><span class="variable">release</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="number">1</span><span class="operator">;</span>
    <span class="operator">}</span>
</code></pre>

</dd>
<dt id="return-ctx-fail_and_release-name-diag">return $ctx-&gt;fail_and_release($name, @diag);</dt>
<dd>

<p>This line issues a <a href="../../../../lib/Test2/Event/Fail.html">Test2::Event::Fail</a> event, releases the context object, and returns false. The fail event will include any diagnostics messages from the <code>@diag</code> array.</p>

<p>This is short form for:</p>

<pre><code>    <span class="variable">$ctx</span><span class="operator">-&gt;</span><span class="variable">fail</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">,</span> <span class="variable">@diag</span><span class="operator">);</span>
    <span class="variable">$ctx</span><span class="operator">-&gt;</span><span class="variable">release</span><span class="operator">;</span>
    <span class="keyword">return</span> <span class="number">0</span><span class="operator">;</span>
</code></pre>

</dd>
</dl>

<h1 id="CONTEXT-OBJECT-DOCUMENTATION">CONTEXT OBJECT DOCUMENTATION</h1>

<p><a href="../../../../lib/Test2/API/Context.html">Test2::API::Context</a> is the place to read up on what methods the context provides.</p>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<p><a href="../../../../lib/Test2/Manual.html">Test2::Manual</a> - Primary index of the manual.</p>

<h1 id="SOURCE">SOURCE</h1>

<p>The source code repository for Test2-Manual can be found at <i>http://github.com/Test-More/Test2-Manual/</i>.</p>

<h1 id="MAINTAINERS">MAINTAINERS</h1>

<dl>

<dt id="Chad-Granum-exodist-cpan.org">Chad Granum &lt;exodist@cpan.org&gt;</dt>
<dd>

</dd>
</dl>

<h1 id="AUTHORS">AUTHORS</h1>

<dl>

<dt id="Chad-Granum-exodist-cpan.org1">Chad Granum &lt;exodist@cpan.org&gt;</dt>
<dd>

</dd>
</dl>

<h1 id="COPYRIGHT">COPYRIGHT</h1>

<p>Copyright 2017 Chad Granum &lt;exodist@cpan.org&gt;.</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<p>See <i>http://dev.perl.org/licenses/</i></p>


</body>

</html>


