<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../../displayToc.js"></script>
<script language="JavaScript" src="../../../tocParas.js"></script>
<script language="JavaScript" src="../../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../../scineplex.css">
<title></title>
<link rel="stylesheet" href="../../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#EXPORTS">EXPORTS</a></li>
  <li><a href="#SOURCE">SOURCE</a></li>
  <li><a href="#MAINTAINERS">MAINTAINERS</a></li>
  <li><a href="#AUTHORS">AUTHORS</a></li>
  <li><a href="#COPYRIGHT">COPYRIGHT</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Test2::Tools::Tester - Tools to help you test other testing tools.</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This is a collection of tools that are useful when testing other test tools.</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>    <span class="keyword">use</span> <span class="variable">Test2::Tools::Tester</span> <span class="string">qw/event_groups filter_events facets/</span><span class="operator">;</span>
    
    <span class="keyword">use</span> <span class="variable">Test2::Tools::Basic</span> <span class="string">qw/plan pass ok/</span><span class="operator">;</span>
    <span class="keyword">use</span> <span class="variable">Test2::Tools::Compare</span> <span class="string">qw/is like/</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">$events</span> <span class="operator">=</span> <span class="variable">intercept</span> <span class="operator">{</span>
        <span class="variable">plan</span> <span class="number">11</span><span class="operator">;</span>
    
        <span class="variable">pass</span><span class="operator">(</span><span class="string">'pass'</span><span class="operator">);</span>
        <span class="variable">ok</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="string">'pass'</span><span class="operator">);</span>
    
        <span class="variable">is</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="string">"pass"</span><span class="operator">);</span>
        <span class="variable">like</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="string">"pass"</span><span class="operator">);</span>
    <span class="operator">};</span>
    
    <span class="comment"># Grab events generated by tools in Test2::Tools::Basic</span>
    <span class="keyword">my</span> <span class="variable">$basic</span> <span class="operator">=</span> <span class="variable">filter</span> <span class="variable">$events</span> <span class="operator">=&gt;</span> <span class="string">'Test2::Tools::Basic'</span><span class="operator">;</span>
    
    <span class="comment"># Grab events generated by Test2::Tools::Basic;</span>
    <span class="keyword">my</span> <span class="variable">$compare</span> <span class="operator">=</span> <span class="variable">filter</span> <span class="variable">$events</span> <span class="operator">=&gt;</span> <span class="string">'Test2::Tools::Compare'</span><span class="operator">;</span>
    
    <span class="comment"># Grab events generated by tools named 'ok'.</span>
    <span class="keyword">my</span> <span class="variable">$oks</span> <span class="operator">=</span> <span class="variable">filter</span> <span class="variable">$events</span> <span class="operator">=&gt;</span> <span class="string">qr/.*::ok$/</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">$grouped</span> <span class="operator">=</span> <span class="variable">group_events</span> <span class="variable">$events</span><span class="operator">;</span>
    <span class="comment"># Breaks events into this structure:</span>
    <span class="operator">{</span>
        <span class="string">'__NA__'</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="operator">...</span> <span class="operator">]</span><span class="operator">,</span>
        <span class="string">'Test2::Tools::Basic'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
            <span class="string">'__ALL__'</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">,</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">,</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">2</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
            <span class="string">plan</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
            <span class="string">pass</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
            <span class="string">ok</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">2</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
        <span class="operator">}</span><span class="operator">,</span>
        <span class="variable">Test2::Tools::Compare</span> <span class="operator">=&gt;</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span><span class="operator">,</span>
    <span class="operator">}</span>
    
    <span class="comment"># Get an arrayref of all the assert facets from the list of events.</span>
    <span class="keyword">my</span> <span class="variable">$assert_facets</span> <span class="operator">=</span> <span class="variable">facets</span> <span class="string">assert</span> <span class="operator">=&gt;</span> <span class="variable">$events</span><span class="operator">;</span>
    <span class="comment"># [</span>
    <span class="comment">#   bless({ details =&gt; 'pass', pass =&gt; 1}, 'Test2::EventFacet::Assert'),</span>
    <span class="comment">#   bless({ details =&gt; 'pass', pass =&gt; 1}, 'Test2::EventFacet::Assert'),</span>
    <span class="comment"># ]</span>
    
    <span class="comment"># Same, but for info facets</span>
    <span class="keyword">my</span> <span class="variable">$info_facets</span> <span class="operator">=</span> <span class="variable">facets</span> <span class="string">info</span> <span class="operator">=&gt;</span> <span class="variable">$events</span><span class="operator">;</span>
</code></pre>

<h1 id="EXPORTS">EXPORTS</h1>

<p>No subs are exported by default.</p>

<dl>

<dt id="array_ref-filter-events-PACKAGE">$array_ref = filter $events =&gt; $PACKAGE</dt>
<dd>

</dd>
<dt id="array_ref-filter-events-PACKAGE1-PACKAGE2">$array_ref = filter $events =&gt; $PACKAGE1, $PACKAGE2</dt>
<dd>

</dd>
<dt id="array_ref-filter-events-qr-match">$array_ref = filter $events =&gt; qr/match/</dt>
<dd>

</dd>
<dt id="array_ref-filter-events-qr-match-PACKAGE">$array_ref = filter $events =&gt; qr/match/, $PACKAGE</dt>
<dd>

<p>This function takes an arrayref of events as the first argument. All additional arguments must either be a package name, or a regex. Any event that is generated by a tool in any of the package, or by a tool that matches any of the regexes, will be returned in an arrayref.</p>

</dd>
<dt id="grouped-group_events-events">$grouped = group_events($events)</dt>
<dd>

<p>This function iterates all the events in the argument arrayref and splits them into groups. The resulting data structure is:</p>

<pre><code>    <span class="operator">{</span> <span class="string">PACKAGE</span> <span class="operator">=&gt;</span> <span class="operator">{</span> <span class="string">SUBNAME</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$EVENT1</span><span class="operator">,</span> <span class="variable">$EVENT2</span><span class="operator">,</span> <span class="operator">...</span> <span class="operator">}</span><span class="operator">}</span>
</code></pre>

<p>If the package of an event is not known it will be put into and arrayref under the &#39;__NA__&#39; key at the root of the structure. If a sub name is not known it will typically go under the &#39;__ANON__&#39; key in under the package name.</p>

<p>In addition there is an &#39;__ALL__&#39; key under each package which stores all of the events sorted into that group.</p>

<p>A more complete example:</p>

<pre><code>    <span class="operator">{</span>
        <span class="string">'__NA__'</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$event</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">3</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
        <span class="string">'Test2::Tools::Basic'</span> <span class="operator">=&gt;</span> <span class="operator">{</span>
            <span class="string">'__ALL__'</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">,</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">,</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">2</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
            <span class="string">plan</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
            <span class="string">pass</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
            <span class="string">ok</span> <span class="operator">=&gt;</span> <span class="operator">[</span> <span class="variable">$events</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">2</span><span class="operator">]</span> <span class="operator">]</span><span class="operator">,</span>
        <span class="operator">}</span><span class="operator">,</span>
    <span class="operator">}</span>
</code></pre>

</dd>
<dt id="arrayref-facets-TYPE-events">$arrayref = facets TYPE =&gt; $events</dt>
<dd>

<p>This function will compile a list of all facets of the specified type that are found in the arrayref of events. If the facet has a <code>Test2::EventFacet::TYPE</code> package available then the facet will be constructed into an instance of the class, otherwise it is left as a hashref. Facet Order is preserved.</p>

<pre><code>    <span class="keyword">my</span> <span class="variable">$assert_facets</span> <span class="operator">=</span> <span class="variable">facets</span> <span class="string">assert</span> <span class="operator">=&gt;</span> <span class="variable">$events</span><span class="operator">;</span>
    <span class="comment"># [</span>
    <span class="comment">#   bless({ details =&gt; 'pass', pass =&gt; 1}, 'Test2::EventFacet::Assert'),</span>
    <span class="comment">#   bless({ details =&gt; 'pass', pass =&gt; 1}, 'Test2::EventFacet::Assert'),</span>
    <span class="comment"># ]</span>
</code></pre>

</dd>
</dl>

<h1 id="SOURCE">SOURCE</h1>

<p>The source code repository for Test2-Suite can be found at <i>http://github.com/Test-More/Test2-Suite/</i>.</p>

<h1 id="MAINTAINERS">MAINTAINERS</h1>

<dl>

<dt id="Chad-Granum-exodist-cpan.org">Chad Granum &lt;exodist@cpan.org&gt;</dt>
<dd>

</dd>
</dl>

<h1 id="AUTHORS">AUTHORS</h1>

<dl>

<dt id="Chad-Granum-exodist-cpan.org1">Chad Granum &lt;exodist@cpan.org&gt;</dt>
<dd>

</dd>
</dl>

<h1 id="COPYRIGHT">COPYRIGHT</h1>

<p>Copyright 2017 Chad Granum &lt;exodist@cpan.org&gt;.</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<p>See <i>http://dev.perl.org/licenses/</i></p>


</body>

</html>


